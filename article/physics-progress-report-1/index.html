<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Godot Engine"><meta name=description content="Update on Godot physics engine improvements: test framework, bug fixing, new features and optimizations."><meta name=theme-color content="#3d8fcc"><meta property="og:site_name" content="Godot Engine"><meta property="og:url" content="https://godotengine.org/article/physics-progress-report-1/"><meta name=twitter:site content="@godotengine"><meta property="og:title" content="Physics progress report #1"><meta property="og:description" content="Update on Godot physics engine improvements: test framework, bug fixing, new features and optimizations."><meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/60a/554/df7/60a554df7b179532579882.png"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><title>Physics progress report #1</title><link rel=alternate type=application/rss+xml title="Godot News" href=/rss.xml><link rel=icon href=/assets/favicon.png sizes=any><link rel=icon href=/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=/assets/css/main.css?112><link rel=stylesheet href=/assets/css/tobii.min.css><link rel=preload as=font href=/assets/fonts/Montserrat-Bold.woff2 crossorigin><link rel=preload as=font href=/assets/fonts/Montserrat-ExtraBold.woff2 crossorigin><link rel=me href=https://mastodon.gamedev.place/@godotengine><input type=checkbox id=nav_toggle_cb><header><div class="container flex align-center"><div id=nav_head><a href=/ id=logo-link><img class=nav-logo src=/assets/logo.svg width=136 height=48 alt="Godot Engine">
<img class="nav-logo dark-logo" src=/assets/logo_dark.svg width=136 height=48 alt="Godot Engine"></a>
<label for=nav_toggle_cb id=nav_toggle_btn><img src=/assets/icons/hamburger.svg width=24 height=24 alt="Main menu"></label></div><nav id=nav><ul class=left><li><a href=/features/>Features</a><li class=only-on-mobile><a href=/showcase/>Showcase</a><li><a href=/blog/>Blog</a><li><a href=/community/>Community</a><li><a href=/contact/>About</a><li><a href=https://godotengine.org/asset-library/asset>Assets</a></ul><ul class=right><li><a href=/download/windows/ class=set-os-download-url>Download</a><li><a href=https://docs.godotengine.org>Docs</a><li><a href=https://docs.godotengine.org/en/stable/community/contributing/index.html>Contribute</a><li class=fund><a href=https://fund.godotengine.org>❤&#xFE0E; Donate</a></ul></nav></div></header><main><style>body{background-color:var(--background-color)}h1{margin-bottom:8px;margin-top:32px}:not(pre)>code{background:var(--code-background-color);padding:1px 4px;font-size:.95em;border-radius:3px}pre{background:var(--codeblock-background-color);color:var(--codeblock-color)}pre code{display:block;overflow-x:auto;padding:.5em}.date-big{line-height:2;margin-left:32px}article{background-color:var(--base-color);box-shadow:0 3px 2px rgba(0,0,0,.15)}figure{margin:0}figure img{margin:0}article img,article video{max-width:100%;height:auto;display:block;margin:auto;margin-top:16px;margin-bottom:16px}article h1{margin-top:64px}article h2,article h3,article h4{margin-top:42px}.article-info{display:flex;flex-direction:column;gap:8px}.article-metadata{display:flex;gap:24px;align-items:center;font-family:var(--header-font-family);margin-bottom:12px}@media(max-width:900px){.article-metadata{flex-direction:column;align-items:flex-start;gap:16px}}.article-author{color:var(--base-color-text-subtitle-date);font-weight:700;font-size:18px;flex-grow:1;display:flex;gap:12px;align-items:center}.article-author .avatar{border-radius:100%;margin:0}.article-author .by{color:var(--base-color-text-subtitle)}.article-metadata .date{color:var(--base-color-text-subtitle-date)}.article-metadata .date.post-recent-highlight{color:var(--post-recent-highlight-color);opacity:.8}.article-metadata .date.post-recent-highlight::after{font-size:80%;content:"NEW";border:2px solid var(--post-recent-highlight-color);padding:2px 3px;margin-left:8px}.tag.active{filter:saturate(.75)}@media screen and (min-width:900px){article .content{width:70%;margin:auto}}@media(max-width:900px){body{background-color:var(--base-color)}article{background-color:initial;box-shadow:none}article img:first-child,article video:first-child{max-width:100%}}</style><link rel=stylesheet href=/assets/css/highlight.obsidian.min.css><div class=container><article class=padded><div class="content article-container"><figure class=article-cover><img src=/storage/app/uploads/public/60a/554/df7/60a554df7b179532579882.png title alt=" " class=rounded-lg style=width:100%;height:auto;background-color:initial></figure><div class=article-info><h1>Physics progress report #1</h1><div class=article-metadata><div class=article-author><span>By:</span>
<img class=avatar width=25 height=25 src=/assets/images/authors/default_avatar.svg alt="Camille Mohr-Daurat" loading=lazy>
<span class=by>Camille Mohr-Daurat</span></div><span class=date data-post-date="2021-05-19 10:35:00 +0000">19 May 2021</span></div><div class=tags><a href=/blog/progress-report><div class="tag active">Progress Report</div></a></div></div><div class="card card-warning"><p>This article is from <strong>May 2021</strong>, some of its contents might be outdated and no longer accurate.<br>You can find up-to-date information about the engine in the <a href=https://docs.godotengine.org/en/stable/>official documentation</a>.</div><div class=article-body><p>Hi!<p>It’s Camille (<a href=https://github.com/pouleyKetchoupp>PouleyKetchoupp</a>) again. I’ve been working on improving Godot Physics since December and time flies! A lot has happened and it’s finally time for some progress update. You might know some things already if you’re following news I post on <a href=https://twitter.com/PouleyKetchoup>Twitter</a> from time to time, but you can read further for more details.<h3 id=test-framework>Test framework</h3><p>First I’ve been working on building a test suite for physics. We needed a test framework because physics features have many different use cases, and it’s easy to break something while fixing or improving something else.<p>The framework has already proven to be useful for both regressions and performance evaluations.<p>You can find the source of the test projects here: <a href=https://github.com/godotengine/godot-demo-projects/tree/master/2d/physics_tests>2D</a> / <a href=https://github.com/godotengine/godot-demo-projects/tree/master/3d/physics_tests>3D</a><p>It’s still a continuous work and there’s a lot to do. I’m adding more tests over time to cover different use cases that come from reported issues. Hopefully, in the near future, it will be solid enough to run periodically to spot engine regressions in an automatic way. We’re almost there!<h3 id=bug-fixing>Bug fixing</h3><p>In order to make the process easier for fixing issues, I’ve also spent some time triaging known issues to have a better picture of the necessary work. Now we have specific trackers for all physics-related issues:<p><a href=https://github.com/godotengine/godot/issues/45334>2D Physics issues</a><p><a href=https://github.com/godotengine/godot/issues/45333>3D Physics issues</a><p><a href=https://github.com/godotengine/godot/issues/45022>Bullet Specific issues</a><p>A lot has been done already to make Godot Physics more stable. Credits for that are shared, as many contributors have helped reporting, testing and fixing issues in physics. So thanks to all involved!<p>You can find more details about the fixes that are part of the recent 3.3 release in the <a href=https://godotengine.org/article/godot-3-3-has-arrived#physics>announcement blog post</a>.<h3 id=godot-physics-features>Godot Physics features</h3><p>As announced <a href=https://godotengine.org/article/camille-mohr-daurat-hired-work-physics>before</a>, Godot Physics will become the default physics engine for Godot 4.0. As a result, Bullet (<a href=https://godotengine.org/article/godot-30-switches-bullet-3-physics>which has been the default since 3.0</a>) will be supported with an official plugin.<p>The transition requires adding missing features that were supported only with Bullet. This makes sure there’s no regression when switching to Godot Physics.<p>Godot Physics is now ready. The missing features were completed recently, and some of them are now retrofitted to Godot 3.x to be part of minor releases.<h4 id=cylinder-collision-shape>Cylinder collision shape</h4><p>One of the requirements was adding support for cylinder shapes in Godot’s custom collision detection system.<p>Cylinder support in Godot Physics is also part of the recent 3.3 release as an experiemental feature (there are still some known issues around character controllers).<p><img src=/storage/app/media/godot-cylinders.gif alt="Animation of Cylinder RigidBodies falling down on each other">
<abbr title></abbr><p><strong>Technical details:</strong><p>Godot Physics is almost entirely based on the <abbr title="Separating Axis Theorem">SAT</abbr> algorithm for collision detection, but cylinders can’t entirely rely on that. The reason is that <abbr title="Separating Axis Theorem">SAT</abbr> requires to mathematically define some axes used to check if a pair of objects are separated from each other. In some cases, this is extremely difficult because of too many complex possibilities, like when using two cylinder shapes.<p>The solution we found was to use a more generic algorithm (in our case <abbr title="Gilbert-Johnson-Keerthi-Expanding Polytope Algorithm">GJK-EPA</abbr>) to find this separation axis. Once this is done, calculate contact points based on the same system we use for other shapes. This system is based on generating contacts with specific pairs of basic features, like points, edges, faces and circles. Circle is a new one used for cylinder rims.<p>Some analytic methods from <a href=https://www.ode.org/>ODE Physics Engine</a> have also been used to solve moderately complex cases in SAT for cylinder-triangle and cylinder-box collision.<ul><li>Initial pull request: <a href=https://github.com/godotengine/godot/pull/45854>GH-45854</a></ul><h4 id=heightmap-collision-shape>Heightmap collision shape</h4><p>Another collision shape that was missing in Godot Physics 3D was the heightmap.<p>It’s now supported as well, and will be part of the future 3.4 release along with 4.0.<p><img src=/storage/app/media/godot-heightmap.gif alt="Animation of a sphere bouncing on a heightmap collision shape">
<abbr title></abbr><p><strong>Technical details:</strong><p>Heightmaps are very similar to triangle meshes in term of collision detection. The difference is that heightmaps use an alternative first step to find which triangles to collide with, and then can use the same algorithm that triangle meshes use to generate contacts.<p>Godot Physics 3D now implements heightmap shapes based on Bullet’s <code class="language-plaintext highlighter-rouge">btHeightfieldTerrainShape</code> class.<p>We needed two types of queries in order to complete heightmaps for Godot Physics: <abbr title="Axis-Aligned Bounding Box">AABB</abbr> queries (for contact solving) and raycast queries (for handling raycasts).<p><abbr title="Axis-Aligned Bounding Box">AABB</abbr> queries are used to find the minimal number of triangles to test for collision in a given area. They are pretty straightforward for heightmaps. Since a heightmap is fundamentally a 2D grid with height variations, the spatial organization makes it easy to find triangles in a given area.<p>Raycast queries are a bit more complex in comparison, especially when it comes to performance. A ray can potentially cover a lot of horizontal distance, which can result in checking many triangles and lead to bad performance. In order to solve this problem, we use an algorithm similar to Bresenham’s line algorithm, which had been implemented in Bullet by <a href=https://github.com/Zylann>Zylann</a>, a Godot contributor who is also behind the <a href=https://github.com/Zylann/godot_heightmap_plugin>Godot Heightmap Terrain plugin</a>.<ul><li>Initial pull request: <a href=https://github.com/godotengine/godot/pull/47347>GH-47347</a><li>Raycast optimization pull request: <a href=https://github.com/godotengine/godot/pull/48708>GH-48708</a></ul><h4 id=soft-body-physics>Soft body physics</h4><p>The last feature that was needed for Godot Physics to match Bullet was support for soft bodies. This can be used for cloth simulation, deformable objects, and more.<p>Again, the idea was to make a similar implementation to make sure settings are as compatible as possible, while keeping the code as lean as possible to make it easy to maintain.<p>Soft bodies will be available in Godot Physics in 4.0. For now, they are still limited to Bullet in 3.x, as they need some extra changes in the physics system that can be considered compatibility breaking.<p><img src=/storage/app/media/godot-soft-bodies-small.gif alt="Animation of spheres bouncing inside a cloth-like cube">
<abbr title></abbr><ul><li>Initial pull request: <a href=https://github.com/godotengine/godot/pull/46937>GH-46937</a></ul><h3 id=optimization>Optimization</h3><p>There’s still more room for further optimization, but Godot Physics performance has greatly improved in the past few months. This affects all aspects of the physics simulation: broadphase (initial quick overlap test to find pairs), narrowphase (detailed collision tests to generate contacts), and impulse solving (moving rigid bodies based on contact points).<p>Most of these optimization features will make it to the 3.4 release. Some of these optimizations will be able to be disabled using project settings, to preserve backwards compatibility in the best way possible.<p>The following describes the main optimizations with more details.<h4 id=multi-threaded-physics-simulation>Multi-threaded physics simulation</h4><p>One of the major coming changes for Godot Physics is the possiblity to make use of multiple CPU cores and run physics simulation tasks in parallel.<p>This allows the narrowphase and impulse solving to be many times faster. Depending on the number of cores, it can make the overall physics simulation 2 to 3 times faster in certain scenarios.<p>There are still areas in the physics step that cause bottlenecks and will be addressed over time, but this is a first step to building a modern physics engine that handles more objects and more complex collisions.<ul><li>Pull request and performance tests: <a href=https://github.com/godotengine/godot/pull/48221>GH-48221</a></ul><h4 id=broadphase-optimization>Broadphase optimization</h4><p>The broadphase optimization is based on the work already made by the contributor <a href=https://github.com/lawnjelly>lawnjelly</a> for Godot 3.3. The contribution brings a new dynamic BVH for 3D physics and rendering (see <a href=https://godotengine.org/article/godot-3-3-has-arrived#dynamic-bvh>here</a> for more details).<p>Now the same spatial partioning is also used for the broadphase in Godot Physics 2D. Both 2D and 3D physics will benefit from the performance improvements.<p>The dynamic BVH will be used by default for 2D in 3.4 the same way 3D physics does in 3.3. An option in project settings will allow switching back to the old hash grid implementation in case you are running into regressions.<ul><li>Original pull request for the 3D broadphase: <a href=https://github.com/godotengine/godot/pull/44901>GH-44901</a><li>Pull request and performance tests for the 2D broadphase: <a href=https://github.com/godotengine/godot/pull/48314>GH-48314</a></ul><h3 id=whats-next>What’s next?</h3><p>To get ready for an alpha release of Godot 4.0, I’m going to spend some time reviewing and finalizing needed API changes for physics. Then I will focus most of my attention to bug fixing.<p>When Godot Physics reaches a state where it’s stable and reliable enough to be used as the default engine in 4.0, it will be time to have a look into adding more features and optimizations that have been on the waiting list for a while.<h2 id=support>Support</h2><p>Godot is a non-profit, open source game engine developed by hundreds of contributors on their free time, and a handful of part or full-time developers, hired thanks to <a href=/donate>donations from the Godot community</a>. A big thank you to everyone who has contributed <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md>their time</a> or <a href=https://github.com/godotengine/godot/blob/master/DONORS.md>financial support</a> to the project!<p>If you’d like to support the project financially and help us secure our future hires, you can do so on <a href=https://www.patreon.com/godotengine>Patreon</a> or <a href=/donate>PayPal</a>.</div></div></article></div><link rel=stylesheet href=/assets/css/anchor-link.css?1><link rel=stylesheet href=/assets/css/article-cards.css?2><script src=/assets/js/anchor-link.js></script>
<script>document.addEventListener('DOMContentLoaded',()=>{window.applyAnchorLinks('.article-body'),document.querySelectorAll('.article-cover img, .article-body img').forEach(b=>{if(b.classList.contains('lightbox-ignore'))return;const a=document.createElement('a');a.href=b.src,a.classList.add('lightbox'),a.dataset.group='article',b.parentNode.appendChild(a),a.appendChild(b)})})</script></main><footer><div class="container flex footer-container"><div id=copyright><p>© 2007-2024 Juan Linietsky, Ariel Manzur and <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md target=_blank rel=noopener>contributors</a>.<br>Hosted by the <a href=https://godot.foundation/ target=_blank rel=noopener>Godot Foundation</a>.<br>Website <a href=https://github.com/godotengine/godot-website target=_blank rel=noopener>source code on GitHub</a>.</div><div id=sitemap><ul class=sitemap-group><li><strong>Get Godot</strong><li><a href=/download/windows/ class=set-os-download-url>Download</a><li><a href=/download/archive/>Release Archive</a><li><a href=https://editor.godotengine.org/releases/latest/>Web Editor</a><li>&nbsp;<li><strong>Public Relations</strong><li><a href=/blog/>Blog</a><li><a href=/community/>Communities and Events</a><li><a href=/press/>Press Kit</a></ul><ul class=sitemap-group><li><strong>About Godot</strong><li><a href=/features/>Features</a><li><a href=/showcase/>Showcase</a><li><a href=/education/>Education</a><li><a href=/license/>License</a><li><a href=/code-of-conduct/>Code of Conduct</a><li><a href=/privacy-policy/>Privacy Policy</a><li><a href=https://fund.godotengine.org>Donate</a></ul><ul class=sitemap-group><li><strong>Project Team</strong><li><a href=/governance/>Governance</a><li><a href=/teams/>Teams</a><li>&nbsp;<li><strong>Extra Resources</strong><li><a href=https://godotengine.org/asset-library/asset>Asset Library</a><li><a href=https://docs.godotengine.org>Documentation</a><li><a href=https://github.com/godotengine>Code Repository</a></ul></div><div id=social class=dark-desaturate><h4 class=text-right><a href=/contact/>Contact us</a></h4><div class="flex justify-space-between" style=gap:3px><a href=https://github.com/godotengine target=_blank rel=noopener><img src=/assets/footer/github_logo.svg width=32 height=32 alt=GitHub></a>
<a href=https://mastodon.gamedev.place/@godotengine target=_blank rel=noopener><img src=/assets/footer/mastodon_logo.svg width=32 height=32 alt=Mastodon></a>
<a href=https://twitter.com/godotengine target=_blank rel=noopener><img src=/assets/footer/twitter_logo.svg width=32 height=32 alt=Twitter></a>
<a href=https://www.facebook.com/groups/godotengine/ target=_blank rel=noopener><img src=/assets/footer/facebook_logo.svg width=32 height=32 alt=Facebook></a>
<a href=https://www.reddit.com/r/godot target=_blank rel=noopener><img src=/assets/footer/reddit_logo.svg width=32 height=32 alt=Red​dit></a>
<a href=/rss.xml target=_blank rel=noopener><img src=/assets/footer/feed_logo.svg width=32 height=32 alt="RSS feed"></a></div></div></div></footer><script defer src=/assets/js/tobii.min.js></script>
<script defer src=/assets/js/highlight.min.js?1></script>
<script defer src=/assets/js/highlight.gdscript.min.js?1></script>
<script>document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('pre code').forEach(a=>{hljs.highlightBlock(a)}),document.querySelectorAll('[data-post-date]').forEach(a=>{Date.parse(a.dataset.postDate)>Date.now()-1e3*60*60*48&&a.classList.add("post-recent-highlight")}),new Tobii({zoom:!1});const a=document.querySelectorAll('.set-os-download-url');for(let b=0;b<a.length;b++){const c=a[b];let e='download';'version'in c.dataset&&c.dataset.version==='3'&&(e='download/3.x');let d='windows';navigator.platform.indexOf('Mac')!==-1?d='macos':navigator.platform.indexOf('Linux')!==-1&&(d='linux'),c.href=`/${e}/${d}/`}})</script>