<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Godot Engine"><meta name=description content="While the focus of Godot 4.0 Vulkan rewrite has largely been improvements to the 3D engine, the 2D side will also see several improvements."><meta name=theme-color content="#3d8fcc"><meta property="og:site_name" content="Godot Engine"><meta property="og:url" content="https://godotengine.org/article/godots-2d-engine-gets-several-improvements-upcoming-40/"><meta name=twitter:site content="@godotengine"><meta property="og:title" content="Godot's 2D engine gets several improvements for upcoming 4.0"><meta property="og:description" content="While the focus of Godot 4.0 Vulkan rewrite has largely been improvements to the 3D engine, the 2D side will also see several improvements."><meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/5fc/2a1/782/5fc2a17821989501808749.png"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><title>Godot's 2D engine gets several improvements for upcoming 4.0</title><link rel=alternate type=application/rss+xml title="Godot News" href=/rss.xml><link rel=icon href=/assets/favicon.png sizes=any><link rel=icon href=/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=/assets/css/main.css?112><link rel=stylesheet href=/assets/css/tobii.min.css><link rel=preload as=font href=/assets/fonts/Montserrat-Bold.woff2 crossorigin><link rel=preload as=font href=/assets/fonts/Montserrat-ExtraBold.woff2 crossorigin><link rel=me href=https://mastodon.gamedev.place/@godotengine><input type=checkbox id=nav_toggle_cb><header><div class="container flex align-center"><div id=nav_head><a href=/ id=logo-link><img class=nav-logo src=/assets/logo.svg width=136 height=48 alt="Godot Engine">
<img class="nav-logo dark-logo" src=/assets/logo_dark.svg width=136 height=48 alt="Godot Engine"></a>
<label for=nav_toggle_cb id=nav_toggle_btn><img src=/assets/icons/hamburger.svg width=24 height=24 alt="Main menu"></label></div><nav id=nav><ul class=left><li><a href=/features/>Features</a><li class=only-on-mobile><a href=/showcase/>Showcase</a><li><a href=/blog/>Blog</a><li><a href=/community/>Community</a><li><a href=/contact/>About</a><li><a href=https://godotengine.org/asset-library/asset>Assets</a></ul><ul class=right><li><a href=/download/windows/ class=set-os-download-url>Download</a><li><a href=https://docs.godotengine.org>Docs</a><li><a href=https://docs.godotengine.org/en/stable/community/contributing/index.html>Contribute</a><li class=fund><a href=https://fund.godotengine.org>❤&#xFE0E; Donate</a></ul></nav></div></header><main><style>body{background-color:var(--background-color)}h1{margin-bottom:8px;margin-top:32px}:not(pre)>code{background:var(--code-background-color);padding:1px 4px;font-size:.95em;border-radius:3px}pre{background:var(--codeblock-background-color);color:var(--codeblock-color)}pre code{display:block;overflow-x:auto;padding:.5em}.date-big{line-height:2;margin-left:32px}article{background-color:var(--base-color);box-shadow:0 3px 2px rgba(0,0,0,.15)}figure{margin:0}figure img{margin:0}article img,article video{max-width:100%;height:auto;display:block;margin:auto;margin-top:16px;margin-bottom:16px}article h1{margin-top:64px}article h2,article h3,article h4{margin-top:42px}.article-info{display:flex;flex-direction:column;gap:8px}.article-metadata{display:flex;gap:24px;align-items:center;font-family:var(--header-font-family);margin-bottom:12px}@media(max-width:900px){.article-metadata{flex-direction:column;align-items:flex-start;gap:16px}}.article-author{color:var(--base-color-text-subtitle-date);font-weight:700;font-size:18px;flex-grow:1;display:flex;gap:12px;align-items:center}.article-author .avatar{border-radius:100%;margin:0}.article-author .by{color:var(--base-color-text-subtitle)}.article-metadata .date{color:var(--base-color-text-subtitle-date)}.article-metadata .date.post-recent-highlight{color:var(--post-recent-highlight-color);opacity:.8}.article-metadata .date.post-recent-highlight::after{font-size:80%;content:"NEW";border:2px solid var(--post-recent-highlight-color);padding:2px 3px;margin-left:8px}.tag.active{filter:saturate(.75)}@media screen and (min-width:900px){article .content{width:70%;margin:auto}}@media(max-width:900px){body{background-color:var(--base-color)}article{background-color:initial;box-shadow:none}article img:first-child,article video:first-child{max-width:100%}}</style><link rel=stylesheet href=/assets/css/highlight.obsidian.min.css><div class=container><article class=padded><div class="content article-container"><figure class=article-cover><img src=/storage/app/uploads/public/5fc/2a1/782/5fc2a17821989501808749.png title alt=" " class=rounded-lg style=width:100%;height:auto;background-color:initial></figure><div class=article-info><h1>Godot's 2D engine gets several improvements for upcoming 4.0</h1><div class=article-metadata><div class=article-author><span>By:</span>
<img class=avatar width=25 height=25 src=/assets/images/authors/reduzio.webp alt="Juan Linietsky" loading=lazy>
<span class=by>Juan Linietsky</span></div><span class=date data-post-date="2020-11-28 00:00:00 +0000">28 November 2020</span></div><div class=tags><a href=/blog/progress-report><div class="tag active">Progress Report</div></a></div></div><div class="card card-warning"><p>This article is from <strong>November 2020</strong>, some of its contents might be outdated and no longer accurate.<br>You can find up-to-date information about the engine in the <a href=https://docs.godotengine.org/en/stable/>official documentation</a>.</div><div class=article-body><p>While the focus of Godot 4.0 Vulkan rewrite has largely been enhancements to the 3D engine, the 2D side will also see several improvements.<h3 id=improved-performance>Improved Performance</h3><p>Thanks to Vulkan (which has a much lower draw-call cost than OpenGL), 2D itself in Godot 4.0 will see a speedup for free. But that’s not the only reason, many internal improvements and optimizations also contribute to a smoother experience. Changes in memory allocation strategy and internal simplification in draw call logic make it much more efficient to manually call thousands of draw() functions from a node’s _draw() callback. Many of these improvements will also accelerate GLES3 and GLES2 back-ends.<h3 id=improved-2d-lighting>Improved 2D lighting</h3><p>Godot 3.x supported 2D lighting, but this did not happen without several constraints. The main one was performance due to every light being rendered in a separate draw pass. This is no longer a problem in 4.0, as all lights are drawn in a single pass.</p><video controls>
<source src=/storage/app/media/4.0/16lights.mp4 type=video/mp4></video><p>Additionally, all 2D shadows and light textures use a single atlas, resulting in improved performance.<h3 id=improved-2d-materials>Improved 2D materials</h3><p>Using normal mapping in 2D was also hit or miss. Some nodes supported the “normal” property, and the look of the lighting was very limited.<p>For Godot 4.0, the new <em>CanvasTexture</em> texture type has been introduced. This new texture type can be used in any node or resource instead of regular textures, and provides not only normal, but specular and shininess maps, allowing for more complex 2D lighting and shading.<p><img src=/storage/app/uploads/public/5fc/29b/040/5fc29b040313b176851112.png alt=ct.png><p>In the example below, a regular Button uses a CanvasTexture, allowing even UI to receive 2D lighting:</p><video controls>
<source src=/storage/app/media/4.0/gg2.mp4 type=video/mp4></video><h3 id=directional-2d-light-and-shadow-support>Directional 2D light and shadow support</h3><p>A very requested feature for the 2D engine is the possibility to have 2D directional lights and shadows. This has been added for 4.0 thanks to the new DirectionalLight2D node.</p><video controls>
<source src=/storage/app/media/4.0/dl2.mp4 type=video/mp4></video><h3 id=canvasgroup>CanvasGroup</h3><p>Another major annoyance for users in Godot 3.x is that, several times, sprites are separated in many nodes in order to be animated or assembled. If a shader is applied to them, or if transparency is changed, the effect is applied to every node individually, given they each do it in their own draw call. This results in undesired effect overlap (or undesired see-through, like the video below)</p><video controls>
<source src=/storage/app/media/4.0/cgroup2.mp4 type=video/mp4></video><p>The new CanvasGroup node merges the draw calls of its children nodes, allowing effects to apply as a whole.</p><video controls>
<source src=/storage/app/media/4.0/cgroup1.mp4 type=video/mp4></video><p>Custom shaders can be used with CanvasGroup to also apply effects like drop shadows or glows to a group of objects as a single one, greatly enhancing the flexibility of the 2D engine.<h3 id=2d-masking--clipping>2D Masking / Clipping</h3><p>The ability to easily mask out children 2D nodes using the parent shape has been one of the most demanded fetures in Godot. This was only doable with very complex workarounds like using viewports or 2D lights, which where limited and inefficient.<p>In the 4.0 branch, this will be doable in a much easier way, thanks to the “clip children” property in the visibility section. This happens at literally no cost and allows for maximum flexibility.<p><img src=/storage/app/uploads/public/5fc/29d/914/5fc29d9142907447129624.jpeg alt=clipchildren.jpeg><h3 id=signed-distance-fields-for-2d>Signed Distance Fields for 2D</h3><p>Signed Distance Fields (or SDF), are one of the new trendy algorithms in 3D graphics. They allow to do so many things! Beginning Godot 4.0 they are supported for 2D. The regular CanvasOccluders have a new option to enable them for SDF rendering. This means that, from any point in the screen, you can request the distance to the closest solid.<p>This has several use cases, but the most common one is circle tracing. A new API was added to do this as easy as possible. Here is an example of a long drop shadow (which would be very slow to do with a regular shader), simulating 2D lightshafts.<p><img src=/storage/app/uploads/public/5fc/29e/9b6/5fc29e9b68aac765092840.png alt=shafts.png><p>Which uses this code:<div class="language-glsl highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=n>shader_type</span> <span class=n>canvas_item</span><span class=p>;</span>
<span class=n>render_mode</span> <span class=n>unshaded</span><span class=p>;</span>

<span class=k>uniform</span> <span class=kt>vec4</span> <span class=n>color</span> <span class=o>:</span> <span class=n>hint_color</span><span class=p>;</span>
<span class=k>uniform</span> <span class=kt>float</span> <span class=n>angle</span> <span class=o>:</span> <span class=n>hint_range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>360</span><span class=p>);</span>
<span class=k>uniform</span> <span class=kt>float</span> <span class=n>len</span> <span class=o>:</span> <span class=n>hint_range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1000</span><span class=p>)</span> <span class=o>=</span> <span class=mi>300</span><span class=p>;</span>
<span class=k>uniform</span> <span class=kt>float</span> <span class=n>fade_margin</span> <span class=o>:</span> <span class=n>hint_range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>100</span><span class=p>)</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>

<span class=kt>void</span> <span class=nf>fragment</span><span class=p>()</span> <span class=p>{</span>

	<span class=kt>float</span> <span class=n>ang_rad</span> <span class=o>=</span> <span class=n>angle</span> <span class=o>*</span> <span class=mi>3</span><span class=p>.</span><span class=mi>1416</span> <span class=o>/</span> <span class=mi>360</span><span class=p>.</span><span class=mi>0</span><span class=p>;</span>
	<span class=kt>vec2</span> <span class=n>dir</span> <span class=o>=</span> <span class=kt>vec2</span><span class=p>(</span><span class=n>sin</span><span class=p>(</span><span class=n>ang_rad</span><span class=p>),</span><span class=n>cos</span><span class=p>(</span><span class=n>ang_rad</span><span class=p>));</span>
	<span class=kt>float</span> <span class=n>max_dist</span> <span class=o>=</span> <span class=n>len</span><span class=p>;</span>
	<span class=kt>vec2</span> <span class=n>at</span> <span class=o>=</span> <span class=n>screen_uv_to_sdf</span><span class=p>(</span><span class=n>SCREEN_UV</span><span class=p>);</span>
	<span class=kt>float</span> <span class=n>accum</span> <span class=o>=</span> <span class=mi>0</span><span class=p>.</span><span class=mi>0</span><span class=p>;</span>

	<span class=k>while</span><span class=p>(</span><span class=n>accum</span> <span class=o>&lt;</span> <span class=n>max_dist</span><span class=p>)</span> <span class=p>{</span>
	    <span class=kt>float</span> <span class=n>d</span> <span class=o>=</span> <span class=n>texture_sdf</span><span class=p>(</span><span class=n>at</span><span class=p>);</span>
	    <span class=n>accum</span><span class=o>+=</span><span class=n>d</span><span class=p>;</span>
	    <span class=k>if</span> <span class=p>(</span><span class=n>d</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>.</span><span class=mo>01</span><span class=p>)</span> <span class=p>{</span>
	        <span class=k>break</span><span class=p>;</span>
	    <span class=p>}</span>
	    <span class=n>at</span> <span class=o>+=</span> <span class=n>d</span> <span class=o>*</span> <span class=n>dir</span><span class=p>;</span>
	<span class=p>}</span>
	<span class=kt>float</span> <span class=n>alpha</span> <span class=o>=</span> <span class=mi>1</span><span class=p>.</span><span class=mi>0</span><span class=o>-</span><span class=n>min</span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>0</span><span class=p>,</span><span class=n>accum</span><span class=o>/</span><span class=n>max_dist</span><span class=p>);</span>
	<span class=k>if</span> <span class=p>(</span><span class=n>accum</span> <span class=o>&lt;</span> <span class=n>fade_margin</span><span class=p>)</span> <span class=p>{</span>
		<span class=n>alpha</span> <span class=o>*=</span> <span class=n>max</span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>0</span><span class=p>,</span><span class=n>accum</span> <span class=o>/</span> <span class=n>fade_margin</span><span class=p>);</span>
	<span class=p>}</span>

	<span class=n>COLOR</span> <span class=o>=</span> <span class=kt>vec4</span><span class=p>(</span><span class=n>color</span><span class=p>.</span><span class=n>rgb</span><span class=p>,</span><span class=n>alpha</span> <span class=o>*</span> <span class=n>color</span><span class=p>.</span><span class=n>a</span><span class=p>);</span>
<span class=p>}</span>

</code></pre></div></div><p>A large amount of other effects can be easily achieved with SDF, such as mist or heat distortion over the floor, 2D global illumination, rain hitting the floor effects, or even procedural shading for the whole screen. The SDF distance is based on scene global coordinates, so measuring distances can be done in a familiar way.<p>The 2D GPU particle system will support particle collisions against the whole scene via SDF. Hopefully, users will give many other cool uses to this new feature.<h3 id=future>Future</h3><p>More work is also going towards the 2D engine. <a href=https://godotengine.org/article/announcing-new-hire-gilles-roudiere>Gilles Roudiere</a> is working on a new 2D tilemap system an editor that will hopefully overcome most of the limitations with the current one. You can follow his progress on this <a href=https://twitter.com/gr0ud>twitter account</a>.<p>As always, keep in mind that we make Godot out of love for you and the whole game development community. We want to make the best and easiest to use game engine, and make it so free and open that you can feel that you made it yourself. If you are not, please consider <a href=https://www.patreon.com/godotengine>becoming our patron</a> to help us out!</div></div></article></div><link rel=stylesheet href=/assets/css/anchor-link.css?1><link rel=stylesheet href=/assets/css/article-cards.css?2><script src=/assets/js/anchor-link.js></script>
<script>document.addEventListener('DOMContentLoaded',()=>{window.applyAnchorLinks('.article-body'),document.querySelectorAll('.article-cover img, .article-body img').forEach(b=>{if(b.classList.contains('lightbox-ignore'))return;const a=document.createElement('a');a.href=b.src,a.classList.add('lightbox'),a.dataset.group='article',b.parentNode.appendChild(a),a.appendChild(b)})})</script></main><footer><div class="container flex footer-container"><div id=copyright><p>© 2007-2024 Juan Linietsky, Ariel Manzur and <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md target=_blank rel=noopener>contributors</a>.<br>Hosted by the <a href=https://godot.foundation/ target=_blank rel=noopener>Godot Foundation</a>.<br>Website <a href=https://github.com/godotengine/godot-website target=_blank rel=noopener>source code on GitHub</a>.</div><div id=sitemap><ul class=sitemap-group><li><strong>Get Godot</strong><li><a href=/download/windows/ class=set-os-download-url>Download</a><li><a href=/download/archive/>Release Archive</a><li><a href=https://editor.godotengine.org/releases/latest/>Web Editor</a><li>&nbsp;<li><strong>Public Relations</strong><li><a href=/blog/>Blog</a><li><a href=/community/>Communities and Events</a><li><a href=/press/>Press Kit</a></ul><ul class=sitemap-group><li><strong>About Godot</strong><li><a href=/features/>Features</a><li><a href=/showcase/>Showcase</a><li><a href=/education/>Education</a><li><a href=/license/>License</a><li><a href=/code-of-conduct/>Code of Conduct</a><li><a href=/privacy-policy/>Privacy Policy</a><li><a href=https://fund.godotengine.org>Donate</a></ul><ul class=sitemap-group><li><strong>Project Team</strong><li><a href=/governance/>Governance</a><li><a href=/teams/>Teams</a><li>&nbsp;<li><strong>Extra Resources</strong><li><a href=https://godotengine.org/asset-library/asset>Asset Library</a><li><a href=https://docs.godotengine.org>Documentation</a><li><a href=https://github.com/godotengine>Code Repository</a></ul></div><div id=social class=dark-desaturate><h4 class=text-right><a href=/contact/>Contact us</a></h4><div class="flex justify-space-between" style=gap:3px><a href=https://github.com/godotengine target=_blank rel=noopener><img src=/assets/footer/github_logo.svg width=32 height=32 alt=GitHub></a>
<a href=https://mastodon.gamedev.place/@godotengine target=_blank rel=noopener><img src=/assets/footer/mastodon_logo.svg width=32 height=32 alt=Mastodon></a>
<a href=https://twitter.com/godotengine target=_blank rel=noopener><img src=/assets/footer/twitter_logo.svg width=32 height=32 alt=Twitter></a>
<a href=https://www.facebook.com/groups/godotengine/ target=_blank rel=noopener><img src=/assets/footer/facebook_logo.svg width=32 height=32 alt=Facebook></a>
<a href=https://www.reddit.com/r/godot target=_blank rel=noopener><img src=/assets/footer/reddit_logo.svg width=32 height=32 alt=Red​dit></a>
<a href=/rss.xml target=_blank rel=noopener><img src=/assets/footer/feed_logo.svg width=32 height=32 alt="RSS feed"></a></div></div></div></footer><script defer src=/assets/js/tobii.min.js></script>
<script defer src=/assets/js/highlight.min.js?1></script>
<script defer src=/assets/js/highlight.gdscript.min.js?1></script>
<script>document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('pre code').forEach(a=>{hljs.highlightBlock(a)}),document.querySelectorAll('[data-post-date]').forEach(a=>{Date.parse(a.dataset.postDate)>Date.now()-1e3*60*60*48&&a.classList.add("post-recent-highlight")}),new Tobii({zoom:!1});const a=document.querySelectorAll('.set-os-download-url');for(let b=0;b<a.length;b++){const c=a[b];let e='download';'version'in c.dataset&&c.dataset.version==='3'&&(e='download/3.x');let d='windows';navigator.platform.indexOf('Mac')!==-1?d='macos':navigator.platform.indexOf('Linux')!==-1&&(d='linux'),c.href=`/${e}/${d}/`}})</script>