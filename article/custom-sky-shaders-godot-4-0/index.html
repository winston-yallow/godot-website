<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Godot Engine"><meta name=description content><meta name=theme-color content="#3d8fcc"><meta property="og:site_name" content="Godot Engine"><meta property="og:url" content="https://godotengine.org/article/custom-sky-shaders-godot-4-0/"><meta name=twitter:site content="@godotengine"><meta property="og:title" content="Custom sky shaders in Godot 4.0"><meta property="og:description" content><meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/5e7/7f2/a75/5e77f2a75cf79778591830.png"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><title>Custom sky shaders in Godot 4.0</title><link rel=alternate type=application/rss+xml title="Godot News" href=/rss.xml><link rel=icon href=/assets/favicon.png sizes=any><link rel=icon href=/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=/assets/css/main.css?112><link rel=stylesheet href=/assets/css/tobii.min.css><link rel=preload as=font href=/assets/fonts/Montserrat-Bold.woff2 crossorigin><link rel=preload as=font href=/assets/fonts/Montserrat-ExtraBold.woff2 crossorigin><link rel=me href=https://mastodon.gamedev.place/@godotengine><input type=checkbox id=nav_toggle_cb><header><div class="container flex align-center"><div id=nav_head><a href=/ id=logo-link><img class=nav-logo src=/assets/logo.svg width=136 height=48 alt="Godot Engine">
<img class="nav-logo dark-logo" src=/assets/logo_dark.svg width=136 height=48 alt="Godot Engine"></a>
<label for=nav_toggle_cb id=nav_toggle_btn><img src=/assets/icons/hamburger.svg width=24 height=24 alt="Main menu"></label></div><nav id=nav><ul class=left><li><a href=/features/>Features</a><li class=only-on-mobile><a href=/showcase/>Showcase</a><li><a href=/blog/>Blog</a><li><a href=/community/>Community</a><li><a href=/contact/>About</a><li><a href=https://godotengine.org/asset-library/asset>Assets</a></ul><ul class=right><li><a href=/download/windows/ class=set-os-download-url>Download</a><li><a href=https://docs.godotengine.org>Docs</a><li><a href=https://docs.godotengine.org/en/stable/community/contributing/index.html>Contribute</a><li class=fund><a href=https://fund.godotengine.org>❤&#xFE0E; Donate</a></ul></nav></div></header><main><style>body{background-color:var(--background-color)}h1{margin-bottom:8px;margin-top:32px}:not(pre)>code{background:var(--code-background-color);padding:1px 4px;font-size:.95em;border-radius:3px}pre{background:var(--codeblock-background-color);color:var(--codeblock-color)}pre code{display:block;overflow-x:auto;padding:.5em}.date-big{line-height:2;margin-left:32px}article{background-color:var(--base-color);box-shadow:0 3px 2px rgba(0,0,0,.15)}figure{margin:0}figure img{margin:0}article img,article video{max-width:100%;height:auto;display:block;margin:auto;margin-top:16px;margin-bottom:16px}article h1{margin-top:64px}article h2,article h3,article h4{margin-top:42px}.article-info{display:flex;flex-direction:column;gap:8px}.article-metadata{display:flex;gap:24px;align-items:center;font-family:var(--header-font-family);margin-bottom:12px}@media(max-width:900px){.article-metadata{flex-direction:column;align-items:flex-start;gap:16px}}.article-author{color:var(--base-color-text-subtitle-date);font-weight:700;font-size:18px;flex-grow:1;display:flex;gap:12px;align-items:center}.article-author .avatar{border-radius:100%;margin:0}.article-author .by{color:var(--base-color-text-subtitle)}.article-metadata .date{color:var(--base-color-text-subtitle-date)}.article-metadata .date.post-recent-highlight{color:var(--post-recent-highlight-color);opacity:.8}.article-metadata .date.post-recent-highlight::after{font-size:80%;content:"NEW";border:2px solid var(--post-recent-highlight-color);padding:2px 3px;margin-left:8px}.tag.active{filter:saturate(.75)}@media screen and (min-width:900px){article .content{width:70%;margin:auto}}@media(max-width:900px){body{background-color:var(--base-color)}article{background-color:initial;box-shadow:none}article img:first-child,article video:first-child{max-width:100%}}</style><link rel=stylesheet href=/assets/css/highlight.obsidian.min.css><div class=container><article class=padded><div class="content article-container"><figure class=article-cover><img src=/storage/app/uploads/public/5e7/7f2/a75/5e77f2a75cf79778591830.png title alt=" " class=rounded-lg style=width:100%;height:auto;background-color:initial></figure><div class=article-info><h1>Custom sky shaders in Godot 4.0</h1><div class=article-metadata><div class=article-author><span>By:</span>
<img class=avatar width=25 height=25 src=/assets/images/authors/clayjohn.jpg alt="Clay John" loading=lazy>
<span class=by>Clay John</span></div><span class=date data-post-date="2020-03-23 02:00:00 +0000">23 March 2020</span></div><div class=tags><a href=/blog/progress-report><div class="tag active">Progress Report</div></a></div></div><div class="card card-warning"><p>This article is from <strong>March 2020</strong>, some of its contents might be outdated and no longer accurate.<br>You can find up-to-date information about the engine in the <a href=https://docs.godotengine.org/en/stable/>official documentation</a>.</div><div class=article-body><hr><p><em><strong>Update (2020-03-24):</strong> The API has updated a little bit to reflect a problem explained in this <a href=https://github.com/godotengine/godot/pull/37268>pull request</a>.</em><p><em><strong>Update (2021-10-28):</strong> You can find a documentation page about Sky shaders in the <a href=https://docs.godotengine.org/en/latest/tutorials/shaders/shader_reference/sky_shader.html>Godot documentation</a>.</em><hr><p>A common problem facing users in Godot 3.x was the inability to create dynamic skies that update in real time. We aim to change that by introducing sky shaders.<p>If you are interested in the implementation, you can find the code <a href=https://github.com/godotengine/godot/pull/37179>on GitHub</a>.<h1 id=sky-resources>Sky resources</h1><p>In Godot 3.x there were two <a href=https://docs.godotengine.org/en/3.2/classes/class_sky.html><code class="language-plaintext highlighter-rouge">Sky</code></a> types, <a href=https://docs.godotengine.org/en/3.2/classes/class_proceduralsky.html><code class="language-plaintext highlighter-rouge">ProceduralSky</code></a> and <a href=https://docs.godotengine.org/en/3.2/classes/class_panoramasky.html><code class="language-plaintext highlighter-rouge">PanoramaSky</code></a>. The common elements between the two came from the parent <code class="language-plaintext highlighter-rouge">Sky</code> class. In Godot 4.0, you will use the <a href=https://docs.godotengine.org/en/latest/classes/class_sky.html><code class="language-plaintext highlighter-rouge">Sky</code></a> class directly. The <code class="language-plaintext highlighter-rouge">Sky</code> class contains 3 properties:<ol><li>A <a href=https://docs.godotengine.org/en/latest/classes/class_material.html><code class="language-plaintext highlighter-rouge">Material</code></a> (can be <a href=https://docs.godotengine.org/en/latest/classes/class_shadermaterial.html><code class="language-plaintext highlighter-rouge">ShaderMaterial</code></a>, <a href=https://docs.godotengine.org/en/latest/classes/class_panoramaskymaterial.html><code class="language-plaintext highlighter-rouge">PanoramaSkyMaterial</code></a>, <a href=https://docs.godotengine.org/en/latest/classes/class_proceduralskymaterial.html><code class="language-plaintext highlighter-rouge">ProceduralSkyMaterial</code></a>, or <a href=https://docs.godotengine.org/en/latest/classes/class_physicalskymaterial.html><code class="language-plaintext highlighter-rouge">PhysicalSkyMaterial</code></a>).<li>The radiance size.<li>The update mode.</ol><p>Instead of subclasses, the behaviour of the <code class="language-plaintext highlighter-rouge">Sky</code> is contained in its <code class="language-plaintext highlighter-rouge">Material</code>. For all three *SkyMaterial types, users can select “Convert to ShaderMaterial” and edit the code directly.<h3 id=panoramaskymaterial><code class="language-plaintext highlighter-rouge">PanoramaSkyMaterial</code></h3><p>The <code class="language-plaintext highlighter-rouge">PanoramaSkyMaterial</code> behaves exactly the same as the previous <code class="language-plaintext highlighter-rouge">PanoramaSky</code>. Assign a panorama texture to the material and you are all done!<h3 id=proceduralskymaterial><code class="language-plaintext highlighter-rouge">ProceduralSkyMaterial</code></h3><p>The <code class="language-plaintext highlighter-rouge">ProceduralSkyMaterial</code> behaves very similarly to the old <code class="language-plaintext highlighter-rouge">ProceduralSky</code> with a few important differences:<ol><li>Supports up to 4 suns.<li>Now updates instantly as calculations are done on the GPU.<li>Sun properties (direction, energy, and color) are pulled from the <a href=https://docs.godotengine.org/en/latest/classes/class_directionallight.html><code class="language-plaintext highlighter-rouge">DirectionalLight</code>s</a> in the scene.</ol><p>These changes make the <code class="language-plaintext highlighter-rouge">ProceduralSkyMaterial</code> a great option for quickly putting together a sky when realism isn’t needed. It is easy to tweak and update and uses a lightweight shader to avoid consuming GPU resources.<h3 id=physicalskymaterial><code class="language-plaintext highlighter-rouge">PhysicalSkyMaterial</code></h3><p>The banner image you see above is from a scene using the new <code class="language-plaintext highlighter-rouge">PhysicalSkyMaterial</code>. The <code class="language-plaintext highlighter-rouge">PhysicalSkyMaterial</code> is a new resource that draws the sky based on various physical properties, notable Rayleigh and Mie scattering. The <code class="language-plaintext highlighter-rouge">PhysicalSkyMaterial</code> is based on the Preetham daylight model (with a few hacks to make it more user friendly at the cost of physical accuracy).<p>The <code class="language-plaintext highlighter-rouge">PhysicalSkyMaterial</code> can only have one sun and it requires the presence of a <code class="language-plaintext highlighter-rouge">DirectionalLight</code> in the scene to illuminate the sky.<p>The main benefit of the <code class="language-plaintext highlighter-rouge">PhysicalSkyMaterial</code> is that you define properties of the sky and then plausible looking changes happen in the sky based on time of day (e.g. sunset and sunrise are automatic).<p>The <code class="language-plaintext highlighter-rouge">PhysicalSkyMaterial</code> is made to be fast and easy to tweak. There are more realistic models of daylight out there, if users need something more realistic they can use <a href=https://docs.godotengine.org/en/latest/classes/class_shadermaterial.html><code class="language-plaintext highlighter-rouge">ShaderMaterial</code>s</a> to implement their own sky models.<h1 id=sky-shaders>Sky Shaders</h1><p>We anticipate that most users will be fine using one of the above three sky materials. But if you need more flexibility, or want to do something more complex (e.g. clouds or nebula) the Sky Shader system is designed to allow you to create whatever you need.<p>Sky Shaders are another type of shader that can be used in a <code class="language-plaintext highlighter-rouge">ShaderMaterial</code>.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>shader_type sky;
</code></pre></div></div><p>Everything in Sky Shaders takes place in the <code class="language-plaintext highlighter-rouge">fragment()</code> function. The output is a single color value, <code class="language-plaintext highlighter-rouge">COLOR</code>.<p>The simplest Sky Shader is:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>shader_type sky;

void fragment() {
    COLOR = vec3(0.2, 0.4, 0.9); // Set the entire sky to a nice shade of blue.
}
</code></pre></div></div><p>Most Sky Shaders will rely on the view direction which is named <code class="language-plaintext highlighter-rouge">EYEDIR</code>. Shaders also provide <code class="language-plaintext highlighter-rouge">POSITION</code> which is the position of the active camera in world space. This can be used to change the sky depending on the location of the camera.<p>Sky Shaders draw to the background and to the radiance cubemap. This allows the scene to receive real-time lighting updates from changes to the sky.<p>Sky Shaders also have two optional built-in subpasses which can be accessed with <code class="language-plaintext highlighter-rouge">HALF_RES_COLOR</code> and <code class="language-plaintext highlighter-rouge">QUARTER_RES_COLOR</code>. These subpasses run the sky shader on a half-resolution or quarter-resolution texture to allow expensive calculations to be done fewer times (e.g. for clouds). Currently, to use the subpasses you must set the appropriate render mode <code class="language-plaintext highlighter-rouge">use_half_res_pass</code> or <code class="language-plaintext highlighter-rouge">use_quarter_res_pass</code>.<p>The following image draws clouds at half resolution to improve performance.
<img src=/storage/app/media/4.0/Sky-Shaders/Godot4-sky-shaders-clouds.png alt="Half-resolution clouds for performance"><p>Sky Shaders allow users to write different code depending on which render target they are using. This allows users to have one version for the cubemap, and another for each subpass.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>shader_type sky;
render_mode use_half_res_pass;

void fragment() {
    if (AT_CUBEMAP_PASS) {
        COLOR = vec3(1.0); // Reflections will be all white.
    } else if (AT_HALF_RES_PASS) {
        vec4 col = generate_fancy_clouds(EYEDIR, TIME); // Clouds will be rendered to half res texture.
        COLOR = col.rgb;
        ALPHA = col.a; // Subpasses can use alpha.
    } else {
        COLOR = HALF_RES_COLOR; // Background will read from HALF_RES_PASS.
    }
}
</code></pre></div></div><p>Finally, Sky Shaders provide access to information about the first 4 <code class="language-plaintext highlighter-rouge">DirectionalLight</code>s in the scene.<ul><li><code class="language-plaintext highlighter-rouge">LIGHT0_DIRECTION</code>: Direction of the first <code class="language-plaintext highlighter-rouge">DirectionalLight</code>.<li><code class="language-plaintext highlighter-rouge">LIGHT0_ENABLED</code>: <code class="language-plaintext highlighter-rouge">true</code> when there is at least one <code class="language-plaintext highlighter-rouge">DirectionalLight</code> in the scene.<li><code class="language-plaintext highlighter-rouge">LIGHT3_COLOR</code>: Color of the fourth light in the scene. If <code class="language-plaintext highlighter-rouge">LIGHT3_ENABLED</code> is <code class="language-plaintext highlighter-rouge">false</code>, this value is undetermined.<li><code class="language-plaintext highlighter-rouge">LIGHT2_ENERGY</code>: Energy of the third <code class="language-plaintext highlighter-rouge">DirectionalLight</code> in the scene.</ul><p>Sky Shaders should allow users to create arbitrarily complex skies. For example, here is a Sky Shader ported over from a <a href=https://www.shadertoy.com/view/MscXRH>Shadertoy shader</a> by Shane called “Combustible Clouds”:
<img src=/storage/app/media/4.0/Sky-Shaders/Godot4-sky-shaders-nebula.png alt="Sky shader ported from Shadertoy"><h2 id=performance-considerations>Performance considerations</h2><p>The Sky Shader is drawn on a full screen quad after all objects are drawn. This means pixels that are occluded will not be drawn. However, this doesn’t apply when updating the radiance map and the subbuffers.<p>In general the best optimization is to avoid updating the radiance cubemap as much as possible. The radiance cubemap updates every frame: when <code class="language-plaintext highlighter-rouge">TIME</code> is used in the shader, when a uniform is changed in the shader, when any of the light properties update, when the screen size is updated (is using subpasses), and when the active camera’s position changes (when using <code class="language-plaintext highlighter-rouge">POSITION</code>). The radiance cubemap updates multiple times per frame if multiple <code class="language-plaintext highlighter-rouge">Camera</code>’s share a <code class="language-plaintext highlighter-rouge">Sky</code> and <code class="language-plaintext highlighter-rouge">POSITION</code> is used in the shader.<p>Users should also try to perform expensive calculations in the subpass buffers and then upscale to the full screen when possible. If the sky is especially smooth, you can even render the entire thing to the radiance cubemap and then read from the cubemap when drawing to the screen.<h2 id=conclusion>Conclusion</h2><p>Please note, if you have existing scenes using the <code class="language-plaintext highlighter-rouge">ProceduralSky</code> or <code class="language-plaintext highlighter-rouge">PanoramaSky</code>, this change will break them and you will have to create a <code class="language-plaintext highlighter-rouge">ProceduralSkyMaterial</code> or a <code class="language-plaintext highlighter-rouge">PanoramaSkyMaterial.</code><p>Since this devlog hasn’t felt very devloggy, here is an in-progess screenshot as a reward for reading! This comes from hunting a bug that arose while working on reading from the radiance cubemap properly.
<img src=/storage/app/media/4.0/Sky-Shaders/Godot4-sky-shaders-cubemap.png alt="Cubemap issue in sky shader"><p>Please test out these new shaders and share what you create!<p>And as always, if you are not yet, consider becoming our <a href=https://www.patreon.com/godotengine>patron</a>. This ensures that Godot development remains free from the control of any company and we can keep working like now, with the freedom to listen to everyone equally.</div></div></article></div><link rel=stylesheet href=/assets/css/anchor-link.css?1><link rel=stylesheet href=/assets/css/article-cards.css?2><script src=/assets/js/anchor-link.js></script>
<script>document.addEventListener('DOMContentLoaded',()=>{window.applyAnchorLinks('.article-body'),document.querySelectorAll('.article-cover img, .article-body img').forEach(b=>{if(b.classList.contains('lightbox-ignore'))return;const a=document.createElement('a');a.href=b.src,a.classList.add('lightbox'),a.dataset.group='article',b.parentNode.appendChild(a),a.appendChild(b)})})</script></main><footer><div class="container flex footer-container"><div id=copyright><p>© 2007-2024 Juan Linietsky, Ariel Manzur and <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md target=_blank rel=noopener>contributors</a>.<br>Hosted by the <a href=https://godot.foundation/ target=_blank rel=noopener>Godot Foundation</a>.<br>Website <a href=https://github.com/godotengine/godot-website target=_blank rel=noopener>source code on GitHub</a>.</div><div id=sitemap><ul class=sitemap-group><li><strong>Get Godot</strong><li><a href=/download/windows/ class=set-os-download-url>Download</a><li><a href=/download/archive/>Release Archive</a><li><a href=https://editor.godotengine.org/releases/latest/>Web Editor</a><li>&nbsp;<li><strong>Public Relations</strong><li><a href=/blog/>Blog</a><li><a href=/community/>Communities and Events</a><li><a href=/press/>Press Kit</a></ul><ul class=sitemap-group><li><strong>About Godot</strong><li><a href=/features/>Features</a><li><a href=/showcase/>Showcase</a><li><a href=/education/>Education</a><li><a href=/license/>License</a><li><a href=/code-of-conduct/>Code of Conduct</a><li><a href=/privacy-policy/>Privacy Policy</a><li><a href=https://fund.godotengine.org>Donate</a></ul><ul class=sitemap-group><li><strong>Project Team</strong><li><a href=/governance/>Governance</a><li><a href=/teams/>Teams</a><li>&nbsp;<li><strong>Extra Resources</strong><li><a href=https://godotengine.org/asset-library/asset>Asset Library</a><li><a href=https://docs.godotengine.org>Documentation</a><li><a href=https://github.com/godotengine>Code Repository</a></ul></div><div id=social class=dark-desaturate><h4 class=text-right><a href=/contact/>Contact us</a></h4><div class="flex justify-space-between" style=gap:3px><a href=https://github.com/godotengine target=_blank rel=noopener><img src=/assets/footer/github_logo.svg width=32 height=32 alt=GitHub></a>
<a href=https://mastodon.gamedev.place/@godotengine target=_blank rel=noopener><img src=/assets/footer/mastodon_logo.svg width=32 height=32 alt=Mastodon></a>
<a href=https://twitter.com/godotengine target=_blank rel=noopener><img src=/assets/footer/twitter_logo.svg width=32 height=32 alt=Twitter></a>
<a href=https://www.facebook.com/groups/godotengine/ target=_blank rel=noopener><img src=/assets/footer/facebook_logo.svg width=32 height=32 alt=Facebook></a>
<a href=https://www.reddit.com/r/godot target=_blank rel=noopener><img src=/assets/footer/reddit_logo.svg width=32 height=32 alt=Red​dit></a>
<a href=/rss.xml target=_blank rel=noopener><img src=/assets/footer/feed_logo.svg width=32 height=32 alt="RSS feed"></a></div></div></div></footer><script defer src=/assets/js/tobii.min.js></script>
<script defer src=/assets/js/highlight.min.js?1></script>
<script defer src=/assets/js/highlight.gdscript.min.js?1></script>
<script>document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('pre code').forEach(a=>{hljs.highlightBlock(a)}),document.querySelectorAll('[data-post-date]').forEach(a=>{Date.parse(a.dataset.postDate)>Date.now()-1e3*60*60*48&&a.classList.add("post-recent-highlight")}),new Tobii({zoom:!1});const a=document.querySelectorAll('.set-os-download-url');for(let b=0;b<a.length;b++){const c=a[b];let e='download';'version'in c.dataset&&c.dataset.version==='3'&&(e='download/3.x');let d='windows';navigator.platform.indexOf('Mac')!==-1?d='macos':navigator.platform.indexOf('Linux')!==-1&&(d='linux'),c.href=`/${e}/${d}/`}})</script>