<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Godot Engine"><meta name=description content="Exposing the new addition to GDScript: optional type hints and all the perks it brings."><meta name=theme-color content="#3d8fcc"><meta property="og:site_name" content="Godot Engine"><meta property="og:url" content="https://godotengine.org/article/optional-typing-gdscript/"><meta name=twitter:site content="@godotengine"><meta property="og:title" content="Optional typing in GDScript"><meta property="og:description" content="Exposing the new addition to GDScript: optional type hints and all the perks it brings."><meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/5b1/f4f/b2f/5b1f4fb2f023a968578982.png"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><title>Optional typing in GDScript</title><link rel=alternate type=application/rss+xml title="Godot News" href=/rss.xml><link rel=icon href=/assets/favicon.png sizes=any><link rel=icon href=/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=/assets/css/main.css?112><link rel=stylesheet href=/assets/css/tobii.min.css><link rel=preload as=font href=/assets/fonts/Montserrat-Bold.woff2 crossorigin><link rel=preload as=font href=/assets/fonts/Montserrat-ExtraBold.woff2 crossorigin><link rel=me href=https://mastodon.gamedev.place/@godotengine><input type=checkbox id=nav_toggle_cb><header><div class="container flex align-center"><div id=nav_head><a href=/ id=logo-link><img class=nav-logo src=/assets/logo.svg width=136 height=48 alt="Godot Engine">
<img class="nav-logo dark-logo" src=/assets/logo_dark.svg width=136 height=48 alt="Godot Engine"></a>
<label for=nav_toggle_cb id=nav_toggle_btn><img src=/assets/icons/hamburger.svg width=24 height=24 alt="Main menu"></label></div><nav id=nav><ul class=left><li><a href=/features/>Features</a><li class=only-on-mobile><a href=/showcase/>Showcase</a><li><a href=/blog/>Blog</a><li><a href=/community/>Community</a><li><a href=/contact/>About</a><li><a href=https://godotengine.org/asset-library/asset>Assets</a></ul><ul class=right><li><a href=/download/windows/ class=set-os-download-url>Download</a><li><a href=https://docs.godotengine.org>Docs</a><li><a href=https://docs.godotengine.org/en/stable/community/contributing/index.html>Contribute</a><li class=fund><a href=https://fund.godotengine.org>❤&#xFE0E; Donate</a></ul></nav></div></header><main><style>body{background-color:var(--background-color)}h1{margin-bottom:8px;margin-top:32px}:not(pre)>code{background:var(--code-background-color);padding:1px 4px;font-size:.95em;border-radius:3px}pre{background:var(--codeblock-background-color);color:var(--codeblock-color)}pre code{display:block;overflow-x:auto;padding:.5em}.date-big{line-height:2;margin-left:32px}article{background-color:var(--base-color);box-shadow:0 3px 2px rgba(0,0,0,.15)}figure{margin:0}figure img{margin:0}article img,article video{max-width:100%;height:auto;display:block;margin:auto;margin-top:16px;margin-bottom:16px}article h1{margin-top:64px}article h2,article h3,article h4{margin-top:42px}.article-info{display:flex;flex-direction:column;gap:8px}.article-metadata{display:flex;gap:24px;align-items:center;font-family:var(--header-font-family);margin-bottom:12px}@media(max-width:900px){.article-metadata{flex-direction:column;align-items:flex-start;gap:16px}}.article-author{color:var(--base-color-text-subtitle-date);font-weight:700;font-size:18px;flex-grow:1;display:flex;gap:12px;align-items:center}.article-author .avatar{border-radius:100%;margin:0}.article-author .by{color:var(--base-color-text-subtitle)}.article-metadata .date{color:var(--base-color-text-subtitle-date)}.article-metadata .date.post-recent-highlight{color:var(--post-recent-highlight-color);opacity:.8}.article-metadata .date.post-recent-highlight::after{font-size:80%;content:"NEW";border:2px solid var(--post-recent-highlight-color);padding:2px 3px;margin-left:8px}.tag.active{filter:saturate(.75)}@media screen and (min-width:900px){article .content{width:70%;margin:auto}}@media(max-width:900px){body{background-color:var(--base-color)}article{background-color:initial;box-shadow:none}article img:first-child,article video:first-child{max-width:100%}}</style><link rel=stylesheet href=/assets/css/highlight.obsidian.min.css><div class=container><article class=padded><div class="content article-container"><figure class=article-cover><img src=/storage/app/uploads/public/5b1/f4f/b2f/5b1f4fb2f023a968578982.png title alt=" " class=rounded-lg style=width:100%;height:auto;background-color:initial></figure><div class=article-info><h1>Optional typing in GDScript</h1><div class=article-metadata><div class=article-author><span>By:</span>
<img class=avatar width=25 height=25 src=/assets/images/authors/vnen.webp alt="George Marques" loading=lazy>
<span class=by>George Marques</span></div><span class=date data-post-date="2018-07-22 17:11:27 +0000">22 July 2018</span></div><div class=tags><a href=/blog/progress-report><div class="tag active">Progress Report</div></a></div></div><div class="card card-warning"><p>This article is from <strong>July 2018</strong>, some of its contents might be outdated and no longer accurate.<br>You can find up-to-date information about the engine in the <a href=https://docs.godotengine.org/en/stable/>official documentation</a>.</div><div class=article-body><p>While GDScript is made with the ease-of-use in mind, many people wanted to add type information into their scripts. This helps avoiding potential bugs and also allows a better code completion. We’re now introducing an additional syntax to add type hints to your GDScript code. It is completely optional and old scripts will work as they always did.<p><strong>Note:</strong> This is a new feature in the <em>master</em> branch, and will be available in Godot 3.1.<h2 id=how-the-type-hints-can-help>How the type hints can help?</h2><p>It is quite common to use a variable only with values of the same type. With the dynamic nature of GDScript, you can inadvertently overwrite a variable with a different type and break your code logic in a way that might be hard to realize.<p>For instance, if your function expects a number, but you missed an input validation somewhere and is passing a string to it instead, you only will see an error at runtime (and only if you reach that point). In a larger code base, it’s quite easy to miss things like that.<p>With type hints, Godot can know beforehand that you are passing the wrong type and show an error while you are editing the related code, even if you never run it.<h2 id=syntax>Syntax</h2><p>This is quite a controversial topic (like tabs vs. spaces) and everyone has their own preference that’s based on their background in other languages. We adopted a post-fixed type syntax that is very similar to Python (yes, Python has type hints too). This was chosen because GDScript is already similar to Python and this style is easy to integrate in the language parser, also considering that it is still optional.<p>For variables and constants, you can add a type hint with a colon (<code class="language-plaintext highlighter-rouge">:</code>) after the name when declaring it. Constants don’t need type hints, since their type is inferred from the assignment, but you can add one as well:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>const GRAVITY : Vector2 = Vector2(0, 9.8)
var power : float = 150.0
</code></pre></div></div><p>Type can be inferred from the assigned value if you add the colon (<code class="language-plaintext highlighter-rouge">:</code>) but omit the type. This can make the code more concise:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>var direction_vector : = Vector2(1, 0)
# direction_vector is of type Vector2 because of the assigned constant
var my_sprite := $MySprite as Sprite
# my_sprite is of type Sprite because of casting
</code></pre></div></div><p>Functions follow the same syntax for the arguments. For the return type, you use a forward arrow (<code class="language-plaintext highlighter-rouge">-></code>) along with type before the colon to start the function body:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>func my_func(arg1 : int, arg2 : String = "") -&gt; void:
    return
</code></pre></div></div><p>Casting types is accomplished by using the <code class="language-plaintext highlighter-rouge">as</code> keyword. For built-in types, it errors out if it’s not possible to convert. For objects it simply returns <code class="language-plaintext highlighter-rouge">null</code>:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>var number_input : int = $LineEdit.text as int
var my_sprite : Sprite = $Sprite as Sprite
</code></pre></div></div><p>The type can be: a built-in Variant type (<code class="language-plaintext highlighter-rouge">int</code>, <code class="language-plaintext highlighter-rouge">Vector3</code>, <code class="language-plaintext highlighter-rouge">Color</code>, <code class="language-plaintext highlighter-rouge">Basis</code>, etc.); a core class (<code class="language-plaintext highlighter-rouge">Node</code>, <code class="language-plaintext highlighter-rouge">Resource</code>, <code class="language-plaintext highlighter-rouge">File</code>, etc.); a named constant that contains a Script resource (<code class="language-plaintext highlighter-rouge">const MyClass = preload("res://my_class.gd"</code>); a named script class (one made with the <code class="language-plaintext highlighter-rouge">class_name</code> syntax).<h2 id=introducing-the-concept-of-safe-lines>Introducing the concept of “safe lines”</h2><p>As suggested by our dear core developer reduz (Juan Linietsky), GDScript now has “safe lines” marked in the editor. The reasoning behind this is that the duck-typing should still work as it always did, so it’s not possible to error if some variable or function is not defined on the accessed class.<p>Something very common is to tell an animation player to start like this:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$AnimationPlayer.play("walk")
</code></pre></div></div><p>With the type inference, Godot knows that <code class="language-plaintext highlighter-rouge">$AnimationPlayer</code> is a <code class="language-plaintext highlighter-rouge">Node</code> but can’t tell which subtype it really is (in this case an <code class="language-plaintext highlighter-rouge">AnimationPlayer</code>). Since the <code class="language-plaintext highlighter-rouge">play()</code> function is not defined on the inferred type (Node), the engine don’t know at this point if it really exists, nor the types for arguments and returns.<p>A statically typed language, such as C++ and C#, would force you to explicitly cast to the specific subtype, otherwise it would throw an error. So you’d need to do this:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>($AnimationPlayer as AnimationPlayer).play("walk")
</code></pre></div></div><p>This is inconvenient most of the time for GDScript. Many times it’s not even really needed. Instead of erroring out, the editor now shows a subtle greenish highlight in the lines that are safe according to type hints:<p><img src=/storage/app/media/safe-line.png alt="Safe line highlight"><p>Some users might find this <em>too</em> subtle. This is actually the idea: it should not stand out for people who aren’t really interested in it. In any case, you can change the color in the editor settings and also disable the highlight if you prefer the old full-dynamic style.<h2 id=code-completion>Code completion</h2><p>The type inference code to provide completion candidates and function hints was rewritten. It fixed some long-standing annoying bugs. The experience is much improved, even if you are not using the type hints.<p>If your code has type hints, it provides a proper completion even across scripts. This includes singletons and scripts attached to other nodes in the tree.<h2 id=how-it-was-implemented>How it was implemented</h2><p>Since many people seem to be interested in the devblogs, I’ll add a section here explaining how I did the changes to enable the optional typing in GDScript.<h3 id=tokenizer>Tokenizer</h3><p>The first part of parsing a language is to split the code in recognizable <em>tokens</em>. The symbols (<code class="language-plaintext highlighter-rouge">+</code>, <code class="language-plaintext highlighter-rouge">>=</code>, <code class="language-plaintext highlighter-rouge">|</code>), keywords (<code class="language-plaintext highlighter-rouge">if</code>, <code class="language-plaintext highlighter-rouge">func</code>, <code class="language-plaintext highlighter-rouge">class</code>), literal values (<code class="language-plaintext highlighter-rouge">2</code>, <code class="language-plaintext highlighter-rouge">"string"</code>), and identifiers ( <code class="language-plaintext highlighter-rouge">Vector2</code>, <code class="language-plaintext highlighter-rouge">Node</code>, <code class="language-plaintext highlighter-rouge">my_var</code>) are all changed to an abstraction This helps the next phase, since it won’t need to deal with text anymore, but just a series of tokens. Then all whitespace and comments will simply be ignored and don’t have to be taken into consideration.<p>The changes in the tokenizer are minimal, only to introduce the forward arrow symbol (<code class="language-plaintext highlighter-rouge">-></code>) and the casting keyword (<code class="language-plaintext highlighter-rouge">as</code>).<p>A peculiarity in the compiled scripts on export is that they are stored as a sequence of tokens. Using this new tokens in an old Godot version will cause a big problem. This is avoided by having a version number that was incremented with this change. So compiled scripts in this version won’t run with older export templates (that’s one reason why it’s important to match editor and template version).<h3 id=parser>Parser</h3><p>The next step is make the new syntax be recognized by the parser. A parser takes the sequence of tokens and from them develop a tree structure. This tree resolves what each line is doing and also sorts out the order of operations based on their precedence.<p>The GDScript parser is relatively simple, so it’s just a matter of understanding the small decisions it make to know what’s a function declaration, what’s a function call, what’s an assignment, etc. I looked into the declarations of variables, constants, and functions to enable the parser to recognize the type hints (though it would simply discard them for now). The expression-parsing routine was also change to detect the casting operation.<p>Casting is a new type of node in the tree, since it’ll be handled by the compiler in a particular way.<h3 id=moving-inheritance-resolution>Moving inheritance resolution</h3><p>The old GDScript only resolved the inheritance when compiling the script, which only happens if you save the script and show errors only when you try to load it (i.e. not when you edit it). However, the parser needs this information to know the types of members declared in the parent.<p>I moved this code from the compiler to the parser (with all the needed adjustments). The compiler simply uses the information from the parser to avoid looking it again. There was also another change in the compiler to fix the order if you are using inner classes, allowing you to reference classes later in the file without problems.<h3 id=static-type-checks>Static type checks</h3><p>Now the parser makes the tree and determine the inheritance. Then a pass on the built tree is needed to check if the types used in the code are compatible or not. It is by far the biggest change in the code.<p><img src=/storage/app/media/type-error.png alt="Static type check"><p>This is done by looking into each statement and applying type-resolution and type-checks depending of the kind of statement. E.g. if it’s an assignment, check if the expression type matches the variable being assigned. This also requires knowing what are the base types of the objects, which can be solved now that the inheritance is resolved in the parser itself.<p>Another required change is having autoload singletons loaded in the editor. This way the parser can look at them as well when trying to figure out the types. That change was added earlier with another pull request.<h3 id=new-typed-instructions>New typed instructions</h3><p>After the parser is done, changes are need in the compiler and the GDScript bytecode to support the type information. GDScript bytecode can be seen as kind of “machine language” that runs on top of the engine core. The compiler is responsible to take the parse tree and create this lower level code.<p>The new instructions allow a runtime-check in the types that could not be determined in the parser. Albeit this might make things <em>slower</em>, it guarantees that the variables will always have the proper type. Since it’s different dealing with built-in types, core classes, and scripts, three new assignment instructions were created to deal with each of them. The same applies to the casting operation.<p>The compiler changes are required to make use of those new instructions, and also to handle the new type of parser node (for casting).<h3 id=editor-niceties>Editor niceties</h3><p>With the backend done, it was time to move into the editor. First and somewhat simpler, I added a colored highlight to the type hints, to help visualizing then in the code. Thanks to the work of Paul Batty (<a href=https://github.com/Paulb23>Paulb23</a>) who isolated the syntax highlighter to the GDScript module, it was simpler to add this small change that didn’t need to affect the core.<p>For the safe lines, however, it required a change in TextEdit and in the script editor to support it.<p>The completion code was rewritten. It was quite hacked since it grew organically over time, so it was hard to add new features to it. With the new code it can better make use of the type hints, and also fix some long-standing bugs that made the completion not so pleasant to use.<p>The new code use the old only as reference. The type inference was improved to consider some other cases (like the returned value from a function) and also to heavily rely on recursive structures, making it simpler to supported indexed variables and methods.<h2 id=future>Future</h2><p>With optional typing, it’s possible to improve GDScript further in other directions. Some of the benefits may also apply to people who are not using the type hints. The ideas for the futures are:
co<ul><li>Enable type hints for signals.<li>Add a system to show warnings in the editor. This allows the game developers to catch things that are not invalid but may cause issues.<li>New instructions for typed code to allow faster execution. This includes avoiding the Variant evaluator and using typed arrays as well.<li>Further optimizations in the compiling stage to remove redundant instructions, reduce constant expressions to final constant, among other things.</ul></div></div></article></div><link rel=stylesheet href=/assets/css/anchor-link.css?1><link rel=stylesheet href=/assets/css/article-cards.css?2><script src=/assets/js/anchor-link.js></script>
<script>document.addEventListener('DOMContentLoaded',()=>{window.applyAnchorLinks('.article-body'),document.querySelectorAll('.article-cover img, .article-body img').forEach(b=>{if(b.classList.contains('lightbox-ignore'))return;const a=document.createElement('a');a.href=b.src,a.classList.add('lightbox'),a.dataset.group='article',b.parentNode.appendChild(a),a.appendChild(b)})})</script></main><footer><div class="container flex footer-container"><div id=copyright><p>© 2007-2024 Juan Linietsky, Ariel Manzur and <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md target=_blank rel=noopener>contributors</a>.<br>Hosted by the <a href=https://godot.foundation/ target=_blank rel=noopener>Godot Foundation</a>.<br>Website <a href=https://github.com/godotengine/godot-website target=_blank rel=noopener>source code on GitHub</a>.</div><div id=sitemap><ul class=sitemap-group><li><strong>Get Godot</strong><li><a href=/download/windows/ class=set-os-download-url>Download</a><li><a href=/download/archive/>Release Archive</a><li><a href=https://editor.godotengine.org/releases/latest/>Web Editor</a><li>&nbsp;<li><strong>Public Relations</strong><li><a href=/blog/>Blog</a><li><a href=/community/>Communities and Events</a><li><a href=/press/>Press Kit</a></ul><ul class=sitemap-group><li><strong>About Godot</strong><li><a href=/features/>Features</a><li><a href=/showcase/>Showcase</a><li><a href=/education/>Education</a><li><a href=/license/>License</a><li><a href=/code-of-conduct/>Code of Conduct</a><li><a href=/privacy-policy/>Privacy Policy</a><li><a href=https://fund.godotengine.org>Donate</a></ul><ul class=sitemap-group><li><strong>Project Team</strong><li><a href=/governance/>Governance</a><li><a href=/teams/>Teams</a><li>&nbsp;<li><strong>Extra Resources</strong><li><a href=https://godotengine.org/asset-library/asset>Asset Library</a><li><a href=https://docs.godotengine.org>Documentation</a><li><a href=https://github.com/godotengine>Code Repository</a></ul></div><div id=social class=dark-desaturate><h4 class=text-right><a href=/contact/>Contact us</a></h4><div class="flex justify-space-between" style=gap:3px><a href=https://github.com/godotengine target=_blank rel=noopener><img src=/assets/footer/github_logo.svg width=32 height=32 alt=GitHub></a>
<a href=https://mastodon.gamedev.place/@godotengine target=_blank rel=noopener><img src=/assets/footer/mastodon_logo.svg width=32 height=32 alt=Mastodon></a>
<a href=https://twitter.com/godotengine target=_blank rel=noopener><img src=/assets/footer/twitter_logo.svg width=32 height=32 alt=Twitter></a>
<a href=https://www.facebook.com/groups/godotengine/ target=_blank rel=noopener><img src=/assets/footer/facebook_logo.svg width=32 height=32 alt=Facebook></a>
<a href=https://www.reddit.com/r/godot target=_blank rel=noopener><img src=/assets/footer/reddit_logo.svg width=32 height=32 alt=Red​dit></a>
<a href=/rss.xml target=_blank rel=noopener><img src=/assets/footer/feed_logo.svg width=32 height=32 alt="RSS feed"></a></div></div></div></footer><script defer src=/assets/js/tobii.min.js></script>
<script defer src=/assets/js/highlight.min.js?1></script>
<script defer src=/assets/js/highlight.gdscript.min.js?1></script>
<script>document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('pre code').forEach(a=>{hljs.highlightBlock(a)}),document.querySelectorAll('[data-post-date]').forEach(a=>{Date.parse(a.dataset.postDate)>Date.now()-1e3*60*60*48&&a.classList.add("post-recent-highlight")}),new Tobii({zoom:!1});const a=document.querySelectorAll('.set-os-download-url');for(let b=0;b<a.length;b++){const c=a[b];let e='download';'version'in c.dataset&&c.dataset.version==='3'&&(e='download/3.x');let d='windows';navigator.platform.indexOf('Mac')!==-1?d='macos':navigator.platform.indexOf('Linux')!==-1&&(d='linux'),c.href=`/${e}/${d}/`}})</script>