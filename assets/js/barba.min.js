!function(b,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(b=b||self).barba=a()}(this,function(){var c,S,R,r,f,g,M,L,K,J,t,H,a,e,x,l,u,I,s,k,m,q,p,O,Q,b,w,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,n,af,P,E,ag;function N(d,c){for(var b=0,a;b<c.length;b++)a=c[b],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}function z(a,b,c){return b&&N(a.prototype,b),c&&N(a,c),a}function h(){return(h=Object.assign||function(d){for(var a=1,b,c;a<arguments.length;a++){b=arguments[a];for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d}).apply(this,arguments)}function o(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}function ae(a){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)})(a)}function y(a,b){return(y=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function T(a,b,c){return(T=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}()?Reflect.construct:function(d,e,b){var a=[null],c;return a.push.apply(a,e),c=new(Function.bind.apply(d,a)),b&&y(c,b.prototype),c}).apply(null,arguments)}function C(b){var a="function"==typeof Map?new Map:void 0;return(C=function(b){if(null===b||-1===Function.toString.call(b).indexOf("[native code]"))return b;if("function"!=typeof b)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(b))return a.get(b);a.set(b,c)}function c(){return T(b,arguments,ae(this).constructor)}return c.prototype=Object.create(b.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),y(c,b)})(b)}function i(c,b){try{var a=c()}catch(a){return b(a)}return a&&a.then?a.then(void 0,b):a}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"))),S="2.9.7",R=function(){},!function(a){a[a.off=0]="off",a[a.error=1]="error",a[a.warning=2]="warning",a[a.info=3]="info",a[a.debug=4]="debug"}(c||(c={})),r=c.off,f=function(){function a(a){this.t=a}a.getLevel=function(){return r},a.setLevel=function(a){return r=c[a]};var b=a.prototype;return b.error=function(){for(var b=arguments.length,d=new Array(b),a=0;a<b;a++)d[a]=arguments[a];this.i(console.error,c.error,d)},b.warn=function(){for(var b=arguments.length,d=new Array(b),a=0;a<b;a++)d[a]=arguments[a];this.i(console.warn,c.warning,d)},b.info=function(){for(var b=arguments.length,d=new Array(b),a=0;a<b;a++)d[a]=arguments[a];this.i(console.info,c.info,d)},b.debug=function(){for(var b=arguments.length,d=new Array(b),a=0;a<b;a++)d[a]=arguments[a];this.i(console.log,c.debug,d)},b.i=function(b,c,d){c<=a.getLevel()&&b.apply(console,["["+this.t+"] "].concat(d))},a}(),g=B,M=G,L=v,K=F,J=D,t="/",H=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function v(h,c){for(var b,e=[],s=0,g=0,a="",k=c&&c.delimiter||t,q=c&&c.whitelist||void 0,j=!1,w,r,o,l,v,x,u,f,m,p,n,i;null!==(b=H.exec(h));)w=b[0],r=b[1],o=b.index,(a+=h.slice(g,o),g=o+w.length,r)?(a+=r[1],j=!0):(l="",v=b[2],x=b[3],u=b[4],f=b[5],!j&&a.length&&(m=a.length-1,p=a[m],(!q||q.indexOf(p)>-1)&&(l=p,a=a.slice(0,m))),a&&(e.push(a),a="",j=!1),n=x||u,i=l||k,e.push({name:v||s++,prefix:l,delimiter:i,optional:"?"===f||"*"===f,repeat:"+"===f||"*"===f,pattern:n?ai(n):"[^"+d(i===k?i:i+k)+"]+?"}));return(a||g<h.length)&&e.push(a+h.substr(g)),e}function G(a,b){return function(k,h){var c=a.exec(k),i,j,g,f,d,e;if(!c)return!1;for(i=c[0],j=c.index,g={},f=h&&h.decode||decodeURIComponent,d=1;d<c.length;d++)void 0!==c[d]&&(e=b[d-1],g[e.name]=e.repeat?c[d].split(e.delimiter).map(function(a){return f(a,e)}):f(c[d],e));return{path:i,index:j,params:g}}}function F(a,d){for(var c=new Array(a.length),b=0;b<a.length;b++)"object"==typeof a[b]&&(c[b]=new RegExp("^(?:"+a[b].pattern+")$",A(d)));return function(k,h){for(var i="",l=h&&h.encode||encodeURIComponent,j=!h||!1!==h.validate,f=0,b,e,d,g;f<a.length;f++)if(b=a[f],"string"!=typeof b)if(d=k?k[b.name]:void 0,Array.isArray(d)){if(!b.repeat)throw new TypeError('Expected "'+b.name+'" to not repeat, but got array');if(0===d.length){if(b.optional)continue;throw new TypeError('Expected "'+b.name+'" to not be empty')}for(g=0;g<d.length;g++){if(e=l(d[g],b),j&&!c[f].test(e))throw new TypeError('Expected all "'+b.name+'" to match "'+b.pattern+'"');i+=(0===g?b.prefix:b.delimiter)+e}}else if("string"!=typeof d&&"number"!=typeof d&&"boolean"!=typeof d){if(!b.optional)throw new TypeError('Expected "'+b.name+'" to be '+(b.repeat?"an array":"a string"))}else{if(e=l(String(d),b),j&&!c[f].test(e))throw new TypeError('Expected "'+b.name+'" to match "'+b.pattern+'", but got "'+e+'"');i+=b.prefix+e}else i+=b;return i}}function d(a){return a.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function ai(a){return a.replace(/([=!:$/()])/g,"\\$1")}function A(a){return a&&a.sensitive?"":"i"}function D(h,l,b){for(var k=(b=b||{}).strict,n=!1!==b.start,m=!1!==b.end,e=b.delimiter||t,g=[].concat(b.endsWith||[]).map(d).concat("$").join("|"),c=n?"^":"",i=0,a,j,f,o;i<h.length;i++)a=h[i],"string"==typeof a?c+=d(a):(j=a.repeat?"(?:"+a.pattern+")(?:"+d(a.delimiter)+"(?:"+a.pattern+"))*":a.pattern,l&&l.push(a),c+=a.optional?a.prefix?"(?:"+d(a.prefix)+"("+j+"))?":"("+j+")?":d(a.prefix)+"("+j+")");return m?(k||(c+="(?:"+d(e)+")?"),c+="$"===g?"$":"(?="+g+")"):(f=h[h.length-1],o="string"==typeof f?f[f.length-1]===e:void 0===f,k||(c+="(?:"+d(e)+"(?="+g+"))?"),o||(c+="(?="+d(e)+"|"+g+")")),new RegExp(c,A(b))}function B(a,b,c){return a instanceof RegExp?function(b,d){var c,a;if(!d)return b;if(c=b.source.match(/\((?!\?)/g),c)for(a=0;a<c.length;a++)d.push({name:a,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return b}(a,b):Array.isArray(a)?function(b,e,c){for(var d=[],a=0;a<b.length;a++)d.push(B(b[a],e,c).source);return new RegExp("(?:"+d.join("|")+")",A(c))}(a,b,c):function(b,c,a){return D(v(b,a),c,a)}(a,b,c)}g.match=function(b,c){var a=[];return G(B(b,a,c),a)},g.regexpToFunction=M,g.parse=L,g.compile=function(b,a){return F(v(b,a),a)},g.tokensToFunction=K,g.tokensToRegExp=J,a={container:"container",history:"history",namespace:"namespace",prefix:"data-barba",prevent:"prevent",wrapper:"wrapper"},e=new(function(){function c(){this.o=a,this.u=new DOMParser}var b=c.prototype;return b.toString=function(a){return a.outerHTML},b.toDocument=function(a){return this.u.parseFromString(a,"text/html")},b.toElement=function(b){var a=document.createElement("div");return a.innerHTML=b,a},b.getHtml=function(a){return void 0===a&&(a=document),this.toString(a.documentElement)},b.getWrapper=function(a){return void 0===a&&(a=document),a.querySelector("["+this.o.prefix+'="'+this.o.wrapper+'"]')},b.getContainer=function(a){return void 0===a&&(a=document),a.querySelector("["+this.o.prefix+'="'+this.o.container+'"]')},b.removeContainer=function(a){document.body.contains(a)&&a.parentNode.removeChild(a)},b.addContainer=function(a,c){var b=this.getContainer();b?this.s(a,b):c.appendChild(a)},b.getNamespace=function(a){void 0===a&&(a=document);var b=a.querySelector("["+this.o.prefix+"-"+this.o.namespace+"]");return b?b.getAttribute(this.o.prefix+"-"+this.o.namespace):null},b.getHref=function(a){if(a.tagName&&"a"===a.tagName.toLowerCase()){if("string"==typeof a.href)return a.href;var b=a.getAttribute("href")||a.getAttribute("xlink:href");if(b)return this.resolveUrl(b.baseVal||b)}return null},b.resolveUrl=function(){for(var f=arguments.length,g=new Array(f),b=0,c,a,d,h,i,e;b<f;b++)g[b]=arguments[b];if(c=g.length,0===c)throw new Error("resolveUrl requires at least one argument; got none.");if(a=document.createElement("base"),a.href=arguments[0],1===c)return a.href;d=document.getElementsByTagName("head")[0],d.insertBefore(a,d.firstChild);for(h,i=document.createElement("a"),e=1;e<c;e++)i.href=arguments[e],a.href=h=i.href;return d.removeChild(a),h},b.s=function(b,a){a.parentNode.insertBefore(b,a.nextSibling)},c}()),x=new(function(){function c(){this.h=[],this.v=-1}var b=c.prototype;return b.init=function(a,d){var b,c;this.l="barba",b={ns:d,scroll:{x:window.scrollX,y:window.scrollY},url:a},this.h.push(b),this.v=0,c={from:this.l,index:0,states:[].concat(this.h)},window.history&&window.history.replaceState(c,"",a)},b.change=function(e,a,b){if(b&&b.state){var c=b.state,d=c.index;a=this.m(this.v-d),this.replace(c.states),this.v=d}else this.add(e,a);return a},b.add=function(a,d){var b=this.size,e=this.p(d),f={ns:"tmp",scroll:{x:window.scrollX,y:window.scrollY},url:a},c;switch(this.h.push(f),this.v=b,c={from:this.l,index:b,states:[].concat(this.h)},e){case"push":window.history&&window.history.pushState(c,"",a);break;case"replace":window.history&&window.history.replaceState(c,"",a)}},b.update=function(b,c){var a=c||this.v,d=h({},this.get(a),{},b);this.set(a,d)},b.remove=function(a){a?this.h.splice(a,1):this.h.pop(),this.v--},b.clear=function(){this.h=[],this.v=-1},b.replace=function(a){this.h=a},b.get=function(a){return this.h[a]},b.set=function(a,b){return this.h[a]=b},b.p=function(e){var c="push",b=e,d=a.prefix+"-"+a.history;return b.hasAttribute&&b.hasAttribute(d)&&(c=b.getAttribute(d)),c},b.m=function(a){return Math.abs(a)>1?a>0?"forward":"back":0===a?"popstate":a>0?"back":"forward"},z(c,[{key:"current",get:function(){return this.h[this.v]}},{key:"state",get:function(){return this.h[this.h.length-1]}},{key:"previous",get:function(){return this.v<1?null:this.h[this.v-1]}},{key:"size",get:function(){return this.h.length}}]),c}()),l=function(c,b){try{var a=function(){if(!b.next.html)return Promise.resolve(c).then(function(a){var c=b.next,d,f;a&&(d=e.toElement(a),c.namespace=e.getNamespace(d),c.container=e.getContainer(d),c.html=a,x.update({ns:c.namespace}),f=e.toDocument(a),document.title=f.title)})}();return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(a){return Promise.reject(a)}},u=g,I={__proto__:null,update:l,nextTick:function(){return new Promise(function(a){window.requestAnimationFrame(a)})},pathToRegexp:u},s=function(){return window.location.origin},k=function(a){return void 0===a&&(a=window.location.href),m(a).port},m=function(b){var c,h=b.match(/:\d+/),i,f,a,g,e,d;return null===h?(/^http/.test(b)&&(c=80),/^https/.test(b)&&(c=443)):(i=h[0].substring(1),c=parseInt(i,10)),a=b.replace(s(),""),g={},e=a.indexOf("#"),e>=0&&(f=a.slice(e+1),a=a.slice(0,e)),d=a.indexOf("?"),d>=0&&(g=q(a.slice(d+1)),a=a.slice(0,d)),{hash:f,path:a,port:c,query:g}},q=function(a){return a.split("&").reduce(function(a,c){var b=c.split("=");return a[b[0]]=b[1],a},{})},p=function(a){return void 0===a&&(a=window.location.href),a.replace(/(\/#.*|\/|#.*)$/,"")},O={__proto__:null,getHref:function(){return window.location.href},getOrigin:s,getPort:k,getPath:function(a){return void 0===a&&(a=window.location.href),m(a).path},parse:m,parseQuery:q,clean:p};function ah(a,b,c){return void 0===b&&(b=2e3),new Promise(function(f,e){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState===XMLHttpRequest.DONE)if(200===d.status)f(d.responseText);else if(d.status){var b={status:d.status,statusText:d.statusText};c(a,b),e(b)}},d.ontimeout=function(){var d=new Error("Timeout error ["+b+"]");c(a,d),e(d)},d.onerror=function(){var b=new Error("Fetch error");c(a,b),e(b)},d.open("GET",a),d.timeout=b,d.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml"),d.setRequestHeader("x-barba","yes"),d.send()})}Q=function(a){return!!a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then};function j(b,a){return void 0===a&&(a={}),function(){for(var d=arguments.length,e=new Array(d),c=0,f,g;c<d;c++)e[c]=arguments[c];return f=!1,g=new Promise(function(c,g){a.async=function(){return f=!0,function(a,b){a?g(a):c(b)}};var d=b.apply(a,e);f||(Q(d)?d.then(c,g):c(d))}),g}}return b=new(function(c){function b(){var a;return(a=c.call(this)||this).logger=new f("@barba/core"),a.all=["ready","page","reset","currentAdded","currentRemoved","nextAdded","nextRemoved","beforeOnce","once","afterOnce","before","beforeLeave","leave","afterLeave","beforeEnter","enter","afterEnter","after"],a.registered=new Map,a.init(),a}o(b,c);var a=b.prototype;return a.init=function(){var a=this;this.registered.clear(),this.all.forEach(function(b){a[b]||(a[b]=function(c,d){a.registered.has(b)||a.registered.set(b,new Set),a.registered.get(b).add({ctx:d||{},fn:c})})})},a.do=function(b){for(var e=this,c=arguments.length,f=new Array(c>1?c-1:0),a=1,d;a<c;a++)f[a-1]=arguments[a];return this.registered.has(b)?(d=Promise.resolve(),this.registered.get(b).forEach(function(a){d=d.then(function(){return j(a.fn,a.ctx).apply(void 0,f)})}),d.catch(function(a){e.logger.debug("Hook error ["+b+"]"),e.logger.error(a)})):Promise.resolve()},a.clear=function(){var a=this;this.all.forEach(function(b){delete a[b]}),this.init()},a.help=function(){this.logger.info("Available hooks: "+this.all.join(","));var a=[];this.registered.forEach(function(c,b){return a.push(b)}),this.logger.info("Registered hooks: "+a.join(","))},b}(R)),w=function(){function a(a){if(this.P=[],"boolean"==typeof a)this.g=a;else{var b=Array.isArray(a)?a:[a];this.P=b.map(function(a){return u(a)})}}return a.prototype.checkHref=function(a){if("boolean"==typeof this.g)return this.g;var b=m(a).path;return this.P.some(function(a){return null!==a.exec(b)})},a}(),U=function(c){function b(b){var a;return(a=c.call(this,b)||this).k=new Map,a}o(b,c);var a=b.prototype;return a.set=function(c,a,b){return this.k.set(c,{action:b,request:a}),{action:b,request:a}},a.get=function(a){return this.k.get(a)},a.getRequest=function(a){return this.k.get(a).request},a.getAction=function(a){return this.k.get(a).action},a.has=function(a){return!this.checkHref(a)&&this.k.has(a)},a.delete=function(a){return this.k.delete(a)},a.update=function(a,c){var b=h({},this.k.get(a),{},c);return this.k.set(a,b),b},b}(w),V=function(){return!window.history.pushState},W=function(a){return!a.el||!a.href},X=function(b){var a=b.event;return a.which>1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey},Y=function(b){var a=b.el;return a.hasAttribute("target")&&"_blank"===a.target},Z=function(b){var a=b.el;return void 0!==a.protocol&&window.location.protocol!==a.protocol||void 0!==a.hostname&&window.location.hostname!==a.hostname},_=function(b){var a=b.el;return void 0!==a.port&&k()!==k(a.href)},$=function(b){var a=b.el;return a.getAttribute&&"string"==typeof a.getAttribute("download")},aa=function(b){return b.el.hasAttribute(a.prefix+"-"+a.prevent)},ab=function(b){return Boolean(b.el.closest("["+a.prefix+"-"+a.prevent+'="all"]'))},ac=function(b){var a=b.href;return p(a)===p()&&k(a)===k()},ad=function(c){function b(b){var a;return(a=c.call(this,b)||this).suite=[],a.tests=new Map,a.init(),a}o(b,c);var a=b.prototype;return a.init=function(){this.add("pushState",V),this.add("exists",W),this.add("newTab",X),this.add("blank",Y),this.add("corsDomain",Z),this.add("corsPort",_),this.add("download",$),this.add("preventSelf",aa),this.add("preventAll",ab),this.add("sameUrl",ac,!1)},a.add=function(b,c,a){void 0===a&&(a=!0),this.tests.set(b,c),a&&this.suite.push(b)},a.run=function(a,b,c,d){return this.tests.get(a)({el:b,event:c,href:d})},a.checkLink=function(a,b,c){var d=this;return this.suite.some(function(e){return d.run(e,a,b,c)})},b}(w),n=function(a){function b(h,e){var c,f,g,d;void 0===e&&(e="Barba error");for(f=arguments.length,g=new Array(f>2?f-2:0),d=2;d<f;d++)g[d-2]=arguments[d];return(c=a.call.apply(a,[this].concat(g))||this).error=h,c.label=e,Error.captureStackTrace&&Error.captureStackTrace(function(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}(c),b),c.name="BarbaError",c}return o(b,a),b}(C(Error)),af=function(){function b(a){void 0===a&&(a=[]),this.logger=new f("@barba/core"),this.all=[],this.page=[],this.once=[],this.A=[{name:"namespace",type:"strings"},{name:"custom",type:"function"}],a&&(this.all=this.all.concat(a)),this.update()}var a=b.prototype;return a.add=function(b,a){switch(b){case"rule":this.A.splice(a.position||0,0,a.value);break;case"transition":default:this.all.push(a)}this.update()},a.resolve=function(c,a){var b=this,e,h,f,g,d,i,j;return void 0===a&&(a={}),e=a.once?this.once:this.page,e=e.filter(a.self?function(a){return a.name&&"self"===a.name}:function(a){return!a.name||"self"!==a.name}),h=new Map,f=e.find(function(d){var e=!0,f={};return!(!a.self||"self"!==d.name)||(b.A.reverse().forEach(function(a){e&&(e=b.R(d,a,c,f),d.from&&d.to&&(e=b.R(d,a,c,f,"from")&&b.R(d,a,c,f,"to")),d.from&&!d.to&&(e=b.R(d,a,c,f,"from")),!d.from&&d.to&&(e=b.R(d,a,c,f,"to")))}),h.set(d,f),e)}),g=h.get(f),d=[],(d.push(a.once?"once":"page"),a.self&&d.push("self"),g)?(j=[f],Object.keys(g).length>0&&j.push(g),(i=this.logger).info.apply(i,["Transition found ["+d.join(",")+"]"].concat(j))):this.logger.info("No transition found ["+d.join(",")+"]"),f},a.update=function(){var a=this;this.all=this.all.map(function(b){return a.T(b)}).sort(function(a,b){return a.priority-b.priority}).reverse().map(function(a){return delete a.priority,a}),this.page=this.all.filter(function(a){return void 0!==a.leave||void 0!==a.enter}),this.once=this.all.filter(function(a){return void 0!==a.once})},a.R=function(p,n,k,j,c){var g=!0,h=!1,i=p,b=n.name,f=b,e=b,o=b,a=c?i[c]:i,d="to"===c?k.next:k.current,m,l;if(c?a&&a[b]:a[b]){switch(n.type){case"strings":default:m=Array.isArray(a[f])?a[f]:[a[f]],d[f]&&-1!==m.indexOf(d[f])&&(h=!0),-1===m.indexOf(d[f])&&(g=!1);break;case"object":l=Array.isArray(a[e])?a[e]:[a[e]],d[e]?(d[e].name&&-1!==l.indexOf(d[e].name)&&(h=!0),-1===l.indexOf(d[e].name)&&(g=!1)):g=!1;break;case"function":a[o](k)?h=!0:g=!1}h&&(c?(j[c]=j[c]||{},j[c][b]=i[c][b]):j[b]=i[b])}return g},a.O=function(a,b,d){var c=0;return(a[b]||a.from&&a.from[b]||a.to&&a.to[b])&&(c+=Math.pow(10,d),a.from&&a.from[b]&&(c+=1),a.to&&a.to[b]&&(c+=2)),c},a.T=function(a){var c=this,b;return a.priority=0,b=0,this.A.forEach(function(d,e){b+=c.O(a,d.name,e+1)}),a.priority=b,a},b}(),P=function(){function c(a){void 0===a&&(a=[]),this.logger=new f("@barba/core"),this.S=!1,this.store=new af(a)}var a=c.prototype;return a.get=function(a,b){return this.store.resolve(a,b)},a.doOnce=function(f){var c=f.data,g=f.transition,e,a,d,b;try{return e=function(){a.S=!1},a=this,d=g||{},a.S=!0,b=i(function(){return Promise.resolve(a.j("beforeOnce",c,d)).then(function(){return Promise.resolve(a.once(c,d)).then(function(){return Promise.resolve(a.j("afterOnce",c,d)).then(function(){})})})},function(b){a.S=!1,a.logger.debug("Transition error [before/after/once]"),a.logger.error(b)}),Promise.resolve(b&&b.then?b.then(e):e())}catch(a){return Promise.reject(a)}},a.doPage=function(d){var b=d.data,m=d.transition,f=d.page,j=d.wrapper,g,k,a,c,h,e;try{return g=function(b){if(k)return b;a.S=!1},k=!1,a=this,c=m||{},h=!0===c.sync||!1,a.S=!0,e=i(function(){function e(){return Promise.resolve(a.j("before",b,c)).then(function(){var e=!1,d;function g(d){return e?d:Promise.resolve(a.remove(b)).then(function(){return Promise.resolve(a.j("after",b,c)).then(function(){})})}return d=function(){if(h)return i(function(){return Promise.resolve(a.add(b,j)).then(function(){return Promise.resolve(a.j("beforeLeave",b,c)).then(function(){return Promise.resolve(a.j("beforeEnter",b,c)).then(function(){return Promise.resolve(Promise.all([a.leave(b,c),a.enter(b,c)])).then(function(){return Promise.resolve(a.j("afterLeave",b,c)).then(function(){return Promise.resolve(a.j("afterEnter",b,c)).then(function(){})})})})})})},function(b){if(a.M(b))throw new n(b,"Transition error [sync]")});var k=function(d){return e?d:i(function(){var d=function(){if(!1!==g)return Promise.resolve(a.add(b,j)).then(function(){return Promise.resolve(a.j("beforeEnter",b,c)).then(function(){return Promise.resolve(a.enter(b,c,g)).then(function(){return Promise.resolve(a.j("afterEnter",b,c)).then(function(){})})})})}();if(d&&d.then)return d.then(function(){})},function(b){if(a.M(b))throw new n(b,"Transition error [before/after/enter]")})},g=!1,d=i(function(){return Promise.resolve(a.j("beforeLeave",b,c)).then(function(){return Promise.resolve(Promise.all([a.leave(b,c),l(f,b)]).then(function(a){return a[0]})).then(function(d){return g=d,Promise.resolve(a.j("afterLeave",b,c)).then(function(){})})})},function(b){if(a.M(b))throw new n(b,"Transition error [before/after/leave]")});return d&&d.then?d.then(k):k(d)}(),d&&d.then?d.then(g):g(d)})}var d=function(){if(h)return Promise.resolve(l(f,b)).then(function(){})}();return d&&d.then?d.then(e):e()},function(b){throw a.S=!1,b.name&&"BarbaError"===b.name?(a.logger.debug(b.label),a.logger.error(b.error),b):(a.logger.debug("Transition error [page]"),a.logger.error(b),b)}),Promise.resolve(e&&e.then?e.then(g):g(e))}catch(a){return Promise.reject(a)}},a.once=function(c,a){try{return Promise.resolve(b.do("once",c,a)).then(function(){return a.once?j(a.once,a)(c):Promise.resolve()})}catch(a){return Promise.reject(a)}},a.leave=function(c,a){try{return Promise.resolve(b.do("leave",c,a)).then(function(){return a.leave?j(a.leave,a)(c):Promise.resolve()})}catch(a){return Promise.reject(a)}},a.enter=function(c,a,d){try{return Promise.resolve(b.do("enter",c,a)).then(function(){return a.enter?j(a.enter,a)(c,d):Promise.resolve()})}catch(a){return Promise.reject(a)}},a.add=function(a,c){try{return e.addContainer(a.next.container,c),b.do("nextAdded",a),Promise.resolve()}catch(a){return Promise.reject(a)}},a.remove=function(a){try{return e.removeContainer(a.current.container),b.do("currentRemoved",a),Promise.resolve()}catch(a){return Promise.reject(a)}},a.M=function(a){return a.message?!/Timeout error|Fetch error/.test(a.message):!a.status},a.j=function(c,d,a){try{return Promise.resolve(b.do(c,d,a)).then(function(){return a[c]?j(a[c],a)(d):Promise.resolve()})}catch(a){return Promise.reject(a)}},z(c,[{key:"isRunning",get:function(){return this.S},set:function(a){this.S=a}},{key:"hasOnce",get:function(){return this.store.once.length>0}},{key:"hasSelf",get:function(){return this.store.all.some(function(a){return"self"===a.name})}},{key:"shouldWait",get:function(){return this.store.all.some(function(a){return a.to&&!a.to.route||a.sync})}}]),c}(),E=function(){function a(a){var c=this;this.names=["beforeLeave","afterLeave","beforeEnter","afterEnter"],this.byNamespace=new Map,0!==a.length&&(a.forEach(function(a){c.byNamespace.set(a.namespace,a)}),this.names.forEach(function(a){b[a](c.L(a))}))}return a.prototype.L=function(a){var b=this;return function(d){var e=a.match(/enter/i)?d.next:d.current,c=b.byNamespace.get(e.namespace);return c&&c[a]?j(c[a],c)(d):Promise.resolve()}},a}(),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(b){var a=this;do{if(a.matches(b))return a;a=a.parentElement||a.parentNode}while(null!==a&&1===a.nodeType)return null}),ag={container:null,html:"",namespace:"",url:{hash:"",href:"",path:"",port:null,query:{}}},new(function(){function d(){this.version=S,this.schemaPage=ag,this.Logger=f,this.logger=new f("@barba/core"),this.plugins=[],this.hooks=b,this.dom=e,this.helpers=I,this.history=x,this.request=ah,this.url=O}var c=d.prototype;return c.use=function(a,c){var b=this.plugins;b.indexOf(a)>-1?this.logger.warn("Plugin ["+a.name+"] already installed."):"function"==typeof a.install?(a.install(this,c),b.push(a)):this.logger.warn("Plugin ["+a.name+'] has no "install" method.')},c.init=function(u){var b=void 0===u?{}:u,o=b.transitions,z=void 0===o?[]:o,n=b.views,y=void 0===n?[]:n,j=b.schema,k=void 0===j?a:j,x=b.requestError,m=b.timeout,w=void 0===m?2e3:m,t=b.cacheIgnore,p=void 0!==t&&t,q=b.prefetchIgnore,r=void 0!==q&&q,s=b.preventRunning,v=void 0!==s&&s,g=b.prevent,d=void 0===g?null:g,l=b.debug,i=b.logLevel,e,c;if(f.setLevel(!0===(void 0!==l&&l)?"debug":void 0===i?"off":i),this.logger.info(this.version),Object.keys(k).forEach(function(b){a[b]&&(a[b]=k[b])}),this.$=x,this.timeout=w,this.cacheIgnore=p,this.prefetchIgnore=r,this.preventRunning=v,this._=this.dom.getWrapper(),!this._)throw new Error("[@barba/core] No Barba wrapper found");if(this._.setAttribute("aria-live","polite"),this.q(),e=this.data.current,!e.container)throw new Error("[@barba/core] No Barba container found");if(this.cache=new U(p),this.prevent=new ad(r),this.transitions=new P(z),this.views=new E(y),null!==d){if("function"!=typeof d)throw new Error("[@barba/core] Prevent should be a function");this.prevent.add("preventCustom",d)}this.history.init(e.url.href,e.namespace),this.B=this.B.bind(this),this.U=this.U.bind(this),this.D=this.D.bind(this),this.F(),this.plugins.forEach(function(a){return a.init()}),c=this.data,c.trigger="barba",c.next=c.current,c.current=h({},this.schemaPage),this.hooks.do("ready",c),this.once(c),this.q()},c.destroy=function(){this.q(),this.H(),this.history.clear(),this.hooks.clear(),this.plugins=[]},c.force=function(a){window.location.assign(a)},c.go=function(b,a,c){var d;if(void 0===a&&(a="barba"),this.transitions.isRunning)this.force(b);else if(!(d="popstate"===a?this.history.current&&this.url.getPath(this.history.current.url)===this.url.getPath(b):this.prevent.run("sameUrl",null,null,b))||this.transitions.hasSelf)return a=this.history.change(b,a,c),c&&(c.stopPropagation(),c.preventDefault()),this.page(b,a,d)},c.once=function(b){try{var a=this;return Promise.resolve(a.hooks.do("beforeEnter",b)).then(function(){function d(){return Promise.resolve(a.hooks.do("afterEnter",b)).then(function(){})}var c=function(){if(a.transitions.hasOnce){var c=a.transitions.get(b,{once:!0});return Promise.resolve(a.transitions.doOnce({transition:c,data:b})).then(function(){})}}();return c&&c.then?c.then(d):d()})}catch(a){return Promise.reject(a)}},c.page=function(b,g,j){var d,a,e,c;try{return d=function(){var b=a.data;return Promise.resolve(a.hooks.do("page",b)).then(function(){var c=i(function(){var c=a.transitions.get(b,{once:!1,self:j});return Promise.resolve(a.transitions.doPage({data:b,page:e,transition:c,wrapper:a._})).then(function(){a.q()})},function(){0===f.getLevel()&&a.force(b.current.url.href)});if(c&&c.then)return c.then(function(){})})},a=this,a.data.next.url=h({href:b},a.url.parse(b)),a.data.trigger=g,e=a.cache.has(b)?a.cache.update(b,{action:"click"}).request:a.cache.set(b,a.request(b,a.timeout,a.onRequestError.bind(a,g)),"click").request,c=function(){if(a.transitions.shouldWait)return Promise.resolve(l(e,a.data)).then(function(){})}(),Promise.resolve(c&&c.then?c.then(d):d())}catch(a){return Promise.reject(a)}},c.onRequestError=function(g){var c,d,a,b,f,e;this.transitions.isRunning=!1;for(c=arguments.length,d=new Array(c>1?c-1:0),a=1;a<c;a++)d[a-1]=arguments[a];return b=d[0],f=d[1],e=this.cache.getAction(b),this.cache.delete(b),!(this.$&&!1===this.$(g,e,b,f)||("click"===e&&this.force(b),1))},c.prefetch=function(a){var b=this;this.cache.has(a)||this.cache.set(a,this.request(a,this.timeout,this.onRequestError.bind(this,"barba")).catch(function(a){b.logger.error(a)}),"prefetch")},c.F=function(){!0!==this.prefetchIgnore&&(document.addEventListener("mouseover",this.B),document.addEventListener("touchstart",this.B)),document.addEventListener("click",this.U),window.addEventListener("popstate",this.D)},c.H=function(){!0!==this.prefetchIgnore&&(document.removeEventListener("mouseover",this.B),document.removeEventListener("touchstart",this.B)),document.removeEventListener("click",this.U),window.removeEventListener("popstate",this.D)},c.B=function(c){var d=this,b=this.I(c),a;b&&(a=this.dom.getHref(b),this.prevent.checkHref(a)||this.cache.has(a)||this.cache.set(a,this.request(a,this.timeout,this.onRequestError.bind(this,b)).catch(function(a){d.logger.error(a)}),"enter"))},c.U=function(a){var b=this.I(a);if(b)return this.transitions.isRunning&&this.preventRunning?(a.preventDefault(),void a.stopPropagation()):void this.go(this.dom.getHref(b),b,a)},c.D=function(a){this.go(this.url.getHref(),"popstate",a)},c.I=function(b){for(var a=b.target;a&&!this.dom.getHref(a);)a=a.parentNode;if(a&&!this.prevent.checkLink(a,b,this.dom.getHref(a)))return a},c.q=function(){var a=this.url.getHref(),b={container:this.dom.getContainer(),html:this.dom.getHtml(),namespace:this.dom.getNamespace(),url:h({href:a},this.url.parse(a))};this.C={current:b,next:h({},this.schemaPage),trigger:void 0},this.hooks.do("reset",this.data)},z(d,[{key:"data",get:function(){return this.C}},{key:"wrapper",get:function(){return this._}}]),d}())})